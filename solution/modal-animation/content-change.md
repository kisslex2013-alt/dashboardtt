Я проанализировал проблему и вижу, что у вас уже реализована анимация для window resize через ResizeObserver, но она не работает для изменений содержимого (children). Проблема в том, что текущий ResizeObserver срабатывает слишком поздно - размер уже изменился.
Предлагаю элегантное решение, которое расширяет текущую логику для работы с изменениями содержимого:
