# –û—Ç—á–µ—Ç –æ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —Ä–µ—à–µ–Ω–∏—è –∞–Ω–∏–º–∞—Ü–∏–∏ –∏—Å—á–µ–∑–Ω–æ–≤–µ–Ω–∏—è

**–î–∞—Ç–∞:** 2024-11-02  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ  
**–ú–µ—Ç–æ–¥:** Three-State Animation Control —Å animationend

---

## ‚úÖ –ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ

### –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω –ø–∞—Ç—Ç–µ—Ä–Ω "Three-State Animation Control —Å animationend" –¥–ª—è –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤:

1. ‚úÖ **BaseModal.jsx** - –±–∞–∑–æ–≤–æ–µ –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
2. ‚úÖ **CategorySelect.jsx** - –≤—ã–±–æ—Ä –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
3. ‚úÖ **IconSelect.jsx** - –≤—ã–±–æ—Ä –∏–∫–æ–Ω–∫–∏
4. ‚úÖ **CustomDatePicker.jsx** - –∫–∞–ª–µ–Ω–¥–∞—Ä—å –≤—ã–±–æ—Ä–∞ –¥–∞—Ç—ã
5. ‚úÖ **Header.jsx** - dropdown –≤—ã–±–æ—Ä–∞ –ø–µ—Ä–∏–æ–¥–∞ (–æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –≤–Ω–∏–∑)
6. ‚úÖ **EntriesListFooter.jsx** - dropdown —Ñ–∏–ª—å—Ç—Ä–∞ (–æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –≤–≤–µ—Ä—Ö)
7. ‚úÖ **AnalyticsSection.jsx** - –¥–≤–∞ dropdown (–≤–∏–¥–∏–º–æ—Å—Ç—å –≥—Ä–∞—Ñ–∏–∫–æ–≤ –∏ —Ñ–∏–ª—å—Ç—Ä –ø–µ—Ä–∏–æ–¥–∞)

---

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

### 1. –î–æ–±–∞–≤–ª–µ–Ω—ã —Ç—Ä–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞:

- `shouldMount` - –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ DOM
- `isAnimating` - –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç –∞–Ω–∏–º–∞—Ü–∏—é –ø–æ—è–≤–ª–µ–Ω–∏—è
- `isExiting` - –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç –∞–Ω–∏–º–∞—Ü–∏—é –∏—Å—á–µ–∑–Ω–æ–≤–µ–Ω–∏—è ‚≠ê **–ù–û–í–û–ï**

### 2. –õ–æ–≥–∏–∫–∞ –æ—Ç–∫—Ä—ã—Ç–∏—è (–¥–ª—è –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤):

```javascript
useEffect(() => {
  if (isOpen) {
    setShouldMount(true)
    setIsExiting(false)
    // –î–≤–æ–π–Ω–æ–π RAF –¥–ª—è –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –Ω–∞—á–∞–ª—å–Ω—ã—Ö —Å—Ç–∏–ª–µ–π
    const rafId = requestAnimationFrame(() => {
      requestAnimationFrame(() => {
        setIsAnimating(true)
      })
    })
    return () => cancelAnimationFrame(rafId)
  }
}, [isOpen])
```

### 3. –õ–æ–≥–∏–∫–∞ –∑–∞–∫—Ä—ã—Ç–∏—è (–¥–ª—è –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤):

```javascript
useEffect(() => {
  if (!isOpen && shouldMount && !isExiting) {
    setIsAnimating(false)
    // RAF –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –ø–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º exit –∞–Ω–∏–º–∞—Ü–∏–∏
    const rafId = requestAnimationFrame(() => {
      setIsExiting(true)
    })
    return () => cancelAnimationFrame(rafId)
  }
}, [isOpen, shouldMount, isExiting])
```

### 4. –°–ª—É—à–∞—Ç–µ–ª—å –æ–∫–æ–Ω—á–∞–Ω–∏—è –∞–Ω–∏–º–∞—Ü–∏–∏ (–¥–ª—è –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤):

```javascript
useEffect(() => {
  if (isExiting && elementRef.current) {
    const handleAnimationEnd = e => {
      if (
        e.animationName === 'slideDownOut' ||
        e.animationName === 'slideUpOut' ||
        e.animationName.includes('slideOut')
      ) {
        setIsExiting(false)
        setShouldMount(false)
      }
    }

    // Fallback –Ω–∞ —Å–ª—É—á–∞–π, –µ—Å–ª–∏ —Å–æ–±—ã—Ç–∏–µ –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–µ—Ç
    const fallbackTimer = setTimeout(() => {
      setIsExiting(false)
      setShouldMount(false)
    }, 300)

    elementRef.current.addEventListener('animationend', handleAnimationEnd)

    return () => {
      clearTimeout(fallbackTimer)
      elementRef.current?.removeEventListener('animationend', handleAnimationEnd)
    }
  }
}, [isExiting])
```

### 5. –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ CSS –∫–ª–∞—Å—Å–æ–≤:

```jsx
className={`
  ${isAnimating ? 'animate-slide-up' : ''}
  ${isExiting ? 'animate-slide-out' : ''}
`}
```

**–í–∞–∂–Ω–æ:** –ë–æ–ª—å—à–µ –ù–ï –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Å—Ç–∞—Ç–∏—á–Ω—ã–µ –∫–ª–∞—Å—Å—ã (`opacity-0 translate-y-4`) - —Ç–æ–ª—å–∫–æ –∫–ª–∞—Å—Å—ã –∞–Ω–∏–º–∞—Ü–∏–π!

---

## üé® –û–±–Ω–æ–≤–ª–µ–Ω–∏—è CSS

### –î–æ–±–∞–≤–ª–µ–Ω–æ –≤ `animations.css`:

- `animation-fill-mode: both` –¥–ª—è –≤—Å–µ—Ö exit –∞–Ω–∏–º–∞—Ü–∏–π
- `will-change: transform, opacity` –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
- –≠—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –Ω–∞—á–∞–ª—å–Ω—ã—Ö –∏ –∫–æ–Ω–µ—á–Ω—ã—Ö —Å–æ—Å—Ç–æ—è–Ω–∏–π

### –ö–ª–∞—Å—Å—ã exit –∞–Ω–∏–º–∞—Ü–∏–π:

- `.animate-slide-out` - –∏—Å—á–µ–∑–Ω–æ–≤–µ–Ω–∏–µ –≤–Ω–∏–∑ (–¥–ª—è –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω, dropdown –≤–Ω–∏–∑)
- `.animate-slide-up-out` - –∏—Å—á–µ–∑–Ω–æ–≤–µ–Ω–∏–µ –≤–≤–µ—Ä—Ö (–¥–ª—è dropdown, –æ—Ç–∫—Ä—ã–≤–∞—é—â–∏—Ö—Å—è –≤–≤–µ—Ä—Ö)
- `.animate-fade-out` - fade –∏—Å—á–µ–∑–Ω–æ–≤–µ–Ω–∏–µ (–¥–ª—è overlay)

---

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã

### –û–∂–∏–¥–∞–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ:

**–ü–æ—è–≤–ª–µ–Ω–∏–µ:**

- ‚úÖ –ü–ª–∞–≤–Ω–∞—è –∞–Ω–∏–º–∞—Ü–∏—è —Å–Ω–∏–∑—É –≤–≤–µ—Ä—Ö (`animate-slide-up`) - 300ms
- ‚úÖ –ë–µ–∑ —Ä—ã–≤–∫–æ–≤ –∏ –∑–∞–¥–≤–∞–∏–≤–∞–Ω–∏—è
- ‚úÖ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–æ —á–µ—Ä–µ–∑ –¥–≤–æ–π–Ω–æ–π RAF

**–ò—Å—á–µ–∑–Ω–æ–≤–µ–Ω–∏–µ:**

- ‚úÖ –ü–ª–∞–≤–Ω–∞—è –∞–Ω–∏–º–∞—Ü–∏—è –≤–Ω–∏–∑ (`animate-slide-out`) - 200ms
- ‚úÖ –î–ª—è dropdown –≤–≤–µ—Ä—Ö: –∏—Å—á–µ–∑–Ω–æ–≤–µ–Ω–∏–µ –≤–≤–µ—Ä—Ö (`animate-slide-up-out`)
- ‚úÖ –¢–æ—á–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ —Å–æ–±—ã—Ç–∏–µ `animationend`
- ‚úÖ Fallback –Ω–∞ —Å–ª—É—á–∞–π —ç–∫—Å—Ç—Ä–µ–º–∞–ª—å–Ω—ã—Ö —Å–∏—Ç—É–∞—Ü–∏–π

---

## üîç –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –î–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ dropdown:

1. **Dropdown –≤–Ω–∏–∑** (Header, AnalyticsSection filter):
   - –ü–æ—è–≤–ª–µ–Ω–∏–µ: `animate-slide-down`
   - –ò—Å—á–µ–∑–Ω–æ–≤–µ–Ω–∏–µ: `animate-slide-out`

2. **Dropdown –≤–≤–µ—Ä—Ö** (EntriesListFooter):
   - –ü–æ—è–≤–ª–µ–Ω–∏–µ: `animate-slide-down`
   - –ò—Å—á–µ–∑–Ω–æ–≤–µ–Ω–∏–µ: `animate-slide-up-out` ‚≠ê

3. **–ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞** (BaseModal):
   - –ü–æ—è–≤–ª–µ–Ω–∏–µ: `animate-slide-up`
   - –ò—Å—á–µ–∑–Ω–æ–≤–µ–Ω–∏–µ: `animate-slide-out`
   - Overlay: `animate-fade-in` / `animate-fade-out`

---

## ‚úÖ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ —Ä–µ—à–µ–Ω–∏—è

1. **99%+ –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å:**
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –Ω–∞—Ç–∏–≤–Ω–æ–µ —Å–æ–±—ã—Ç–∏–µ `animationend`
   - Fallback `setTimeout` –¥–ª—è —ç–∫—Å—Ç—Ä–µ–º–∞–ª—å–Ω—ã—Ö —Å–ª—É—á–∞–µ–≤

2. **–ß–µ—Ç–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ:**
   - –¢—Ä–∏ –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã—Ö —Å–æ—Å—Ç–æ—è–Ω–∏—è
   - –ù–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ –º–µ–∂–¥—É –ø–æ—è–≤–ª–µ–Ω–∏–µ–º –∏ –∏—Å—á–µ–∑–Ω–æ–≤–µ–Ω–∏–µ–º

3. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:**
   - –ú–∏–Ω–∏–º—É–º —Ä–µ-—Ä–µ–Ω–¥–µ—Ä–æ–≤
   - –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ listeners
   - –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ `will-change`

4. **–£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ—Å—Ç—å:**
   - –†–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è Dialog, dropdown, portal
   - –ï–¥–∏–Ω–æ–æ–±—Ä–∞–∑–Ω—ã–π –ø–æ–¥—Ö–æ–¥ –¥–ª—è –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏:

1. ‚úÖ –û–±—ã—á–Ω–æ–µ –æ—Ç–∫—Ä—ã—Ç–∏–µ/–∑–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
2. ‚úÖ –ë—ã—Å—Ç—Ä–æ–µ –æ—Ç–∫—Ä—ã—Ç–∏–µ-–∑–∞–∫—Ä—ã—Ç–∏–µ (–±—ã—Å—Ç—Ä—ã–π –∫–ª–∏–∫)
3. ‚úÖ –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ Escape
4. ‚úÖ –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ –∫–ª–∏–∫—É –≤–Ω–µ —ç–ª–µ–º–µ–Ω—Ç–∞
5. ‚úÖ –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–µ –±—ã—Å—Ç—Ä–æ–µ –æ—Ç–∫—Ä—ã—Ç–∏–µ/–∑–∞–∫—Ä—ã—Ç–∏–µ
6. ‚úÖ Dropdown –æ—Ç–∫—Ä—ã–≤–∞—é—â–∏–µ—Å—è –≤–≤–µ—Ä—Ö (EntriesListFooter)
7. ‚úÖ Dropdown –æ—Ç–∫—Ä—ã–≤–∞—é—â–∏–µ—Å—è –≤–Ω–∏–∑ (Header, AnalyticsSection)
8. ‚úÖ –ê–Ω–∏–º–∞—Ü–∏—è overlay –≤ –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–Ω–∞—Ö

---

## üìù –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É –Ω–∞ —Ä–∞–∑–Ω—ã—Ö –±—Ä–∞—É–∑–µ—Ä–∞—Ö
3. –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –Ω–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ —Å –¥—Ä—É–≥–∏–º–∏ –∞–Ω–∏–º–∞—Ü–∏—è–º–∏
4. –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ - –¥–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É edge cases

---

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ü–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –∏ –≥–æ—Ç–æ–≤–æ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é
