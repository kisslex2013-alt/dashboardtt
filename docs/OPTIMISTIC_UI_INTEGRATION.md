# üéØ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è Optimistic UI Updates

## –ß—Ç–æ —Ç–∞–∫–æ–µ Optimistic UI?

**Optimistic UI** - —ç—Ç–æ –ø–∞—Ç—Ç–µ—Ä–Ω –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞, –ø—Ä–∏ –∫–æ—Ç–æ—Ä–æ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è **–º–≥–Ω–æ–≤–µ–Ω–Ω–æ**, –Ω–µ –¥–æ–∂–∏–¥–∞—è—Å—å –æ—Ç–≤–µ—Ç–∞ –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞ –∏–ª–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏.

### –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:

1. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–ø–æ–ª–Ω—è–µ—Ç –¥–µ–π—Å—Ç–≤–∏–µ** (–Ω–∞–ø—Ä–∏–º–µ—Ä, —É–¥–∞–ª—è–µ—Ç –∑–∞–ø–∏—Å—å)
2. **UI –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ** - –∑–∞–ø–∏—Å—å –∏—Å—á–µ–∑–∞–µ—Ç –∏–∑ —Å–ø–∏—Å–∫–∞
3. **–í —Ñ–æ–Ω–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è** (—É–¥–∞–ª–µ–Ω–∏–µ –∏–∑ store/API)
4. **–ï—Å–ª–∏ –æ–ø–µ—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞** - –≤—Å—ë –æ—Å—Ç–∞–µ—Ç—Å—è –∫–∞–∫ –µ—Å—Ç—å
5. **–ï—Å–ª–∏ –æ–ø–µ—Ä–∞—Ü–∏—è –ø—Ä–æ–≤–∞–ª–∏–ª–∞—Å—å** - UI –æ—Ç–∫–∞—Ç—ã–≤–∞–µ—Ç—Å—è –∫ –ø—Ä–µ–¥—ã–¥—É—â–µ–º—É —Å–æ—Å—Ç–æ—è–Ω–∏—é

### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:

- ‚úÖ **–ú–æ–º–µ–Ω—Ç–∞–ª—å–Ω–∞—è –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å** - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å—Ä–∞–∑—É –≤–∏–¥–∏—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç
- ‚úÖ **–£–ª—É—á—à–µ–Ω–Ω–æ–µ UX** - –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∫–∞–∂–µ—Ç—Å—è –±—ã—Å—Ç—Ä–µ–µ
- ‚úÖ **–ú–µ–Ω—å—à–µ –æ–∂–∏–¥–∞–Ω–∏—è** - –Ω–µ—Ç –∑–∞–¥–µ—Ä–∂–µ–∫ –Ω–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–π

### –ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏ –±–µ–∑ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:

- ‚ùå **–†–∞—Å—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è** - UI –º–æ–∂–µ—Ç –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ –¥–∞–Ω–Ω—ã–µ
- ‚ùå **–°–ª–æ–∂–Ω–æ—Å—Ç—å –æ—Ç–∫–∞—Ç–∞** - –Ω—É–∂–Ω–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –æ—à–∏–±–∫–∏
- ‚ùå **–ü—É—Ç–∞–Ω–∏—Ü–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è** - –µ—Å–ª–∏ –æ—Ç–∫–∞—Ç –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Å–ª–∏—à–∫–æ–º –ø–æ–∑–¥–Ω–æ

---

## –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤ –ø—Ä–æ–µ–∫—Ç–µ

### ‚úÖ –ß—Ç–æ —É–∂–µ –µ—Å—Ç—å:

1. **–•—É–∫ `useOptimisticUpdate`** —Å–æ–∑–¥–∞–Ω –≤ `src/hooks/useOptimisticUpdate.js`
2. –•—É–∫ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç:
   - `value` - —Ç–µ–∫—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ (–æ–ø—Ç–∏–º–∏—Å—Ç–∏—á–Ω–æ–µ –∏–ª–∏ –∞–∫—Ç—É–∞–ª—å–Ω–æ–µ)
   - `isPending` - —Ñ–ª–∞–≥ –æ–∂–∏–¥–∞–Ω–∏—è –æ–ø–µ—Ä–∞—Ü–∏–∏
   - `error` - –æ—à–∏–±–∫–∞, –µ—Å–ª–∏ –æ–ø–µ—Ä–∞—Ü–∏—è –ø—Ä–æ–≤–∞–ª–∏–ª–∞—Å—å
   - `update()` - —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–ø—Ç–∏–º–∏—Å—Ç–∏—á–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
   - `reset()` - —Å–±—Ä–æ—Å –∫ –Ω–∞—á–∞–ª—å–Ω–æ–º—É –∑–Ω–∞—á–µ–Ω–∏—é

### ‚ùå –ß—Ç–æ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç:

–•—É–∫ **–ù–ï –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω** –Ω–∏ –≤ –æ–¥–∏–Ω –∫–æ–º–ø–æ–Ω–µ–Ω—Ç. –û–Ω —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, –Ω–æ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏.

**–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã, –∫–æ—Ç–æ—Ä—ã–º –Ω—É–∂–Ω–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è:**

1. `EntryItem.tsx` - —É–¥–∞–ª–µ–Ω–∏–µ –∑–∞–ø–∏—Å–∏ (–∫–Ω–æ–ø–∫–∞ Trash2)
2. `EditEntryModal.tsx` - —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —É–¥–∞–ª–µ–Ω–∏–µ –∑–∞–ø–∏—Å–∏
3. `BulkActionsPanel.tsx` - –º–∞—Å—Å–æ–≤–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –∑–∞–ø–∏—Å–µ–π

---

## üìù –ü—Ä–∏–º–µ—Ä—ã –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

### –ü—Ä–∏–º–µ—Ä 1: Optimistic Delete –≤ `EntryItem.tsx`

#### –î–æ (—Ç–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è):

```tsx
// src/components/entries/EntryItem.tsx
const handleDelete = () => {
  triggerHaptic('error')
  openConfirm({
    title: '–£–¥–∞–ª–∏—Ç—å –∑–∞–ø–∏—Å—å?',
    message: '–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç—É –∑–∞–ø–∏—Å—å?',
    onConfirm: () => {
      triggerHaptic('heavy')
      deleteEntry(entry.id) // ‚ùå –°–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ - UI –∂–¥–µ—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
    },
  })
}
```

**–ü—Ä–æ–±–ª–µ–º–∞:** –ó–∞–ø–∏—Å—å –∏—Å—á–µ–∑–∞–µ—Ç –∏–∑ UI —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è `deleteEntry()`. –ï—Å–ª–∏ –æ–ø–µ—Ä–∞—Ü–∏—è –º–µ–¥–ª–µ–Ω–Ω–∞—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, sync —Å —Å–µ—Ä–≤–µ—Ä–æ–º –≤ –±—É–¥—É—â–µ–º), –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –±—É–¥–µ—Ç –∂–¥–∞—Ç—å.

---

#### –ü–æ—Å–ª–µ (—Å Optimistic UI):

```tsx
// src/components/entries/EntryItem.tsx
import { useOptimisticUpdate } from '../../hooks/useOptimisticUpdate'

export const EntryItem = memo(({ entry, onEdit }) => {
  const deleteEntry = useDeleteEntry()
  const triggerHaptic = useHapticFeedback()
  const { confirmConfig, openConfirm } = useConfirmModal()

  // üéØ –ù–û–í–û–ï: Optimistic state –¥–ª—è –≤–∏–¥–∏–º–æ—Å—Ç–∏ –∑–∞–ø–∏—Å–∏
  const {
    value: isVisible,
    isPending: isDeleting,
    error: deleteError,
    update: optimisticDelete,
  } = useOptimisticUpdate(true) // –ò–∑–Ω–∞—á–∞–ª—å–Ω–æ –∑–∞–ø–∏—Å—å –≤–∏–¥–Ω–∞

  const handleDelete = () => {
    triggerHaptic('error')
    openConfirm({
      title: '–£–¥–∞–ª–∏—Ç—å –∑–∞–ø–∏—Å—å?',
      message: '–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç—É –∑–∞–ø–∏—Å—å?',
      onConfirm: async () => {
        triggerHaptic('heavy')

        try {
          // üéØ Optimistic update: —Å—Ä–∞–∑—É —Å–∫—Ä—ã–≤–∞–µ–º –∑–∞–ø–∏—Å—å
          await optimisticDelete(
            false, // –û–ø—Ç–∏–º–∏—Å—Ç–∏—á–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ - –∑–∞–ø–∏—Å—å —Å–∫—Ä—ã—Ç–∞
            async () => {
              // –§–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –≤ —Ñ–æ–Ω–µ
              await deleteEntry(entry.id)
              return false // –§–∏–Ω–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ - –∑–∞–ø–∏—Å—å —É–¥–∞–ª–µ–Ω–∞
            }
          )
        } catch (error) {
          // ‚ùå –ï—Å–ª–∏ —É–¥–∞–ª–µ–Ω–∏–µ –ø—Ä–æ–≤–∞–ª–∏–ª–æ—Å—å, –∑–∞–ø–∏—Å—å –≤–µ—Ä–Ω–µ—Ç—Å—è (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
          console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏:', error)
          // –ú–æ–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
        }
      },
    })
  }

  // üéØ –ï—Å–ª–∏ –∑–∞–ø–∏—Å—å —Å–∫—Ä—ã—Ç–∞ –æ–ø—Ç–∏–º–∏—Å—Ç–∏—á–Ω–æ - –Ω–µ —Ä–µ–Ω–¥–µ—Ä–∏–º –µ—ë
  if (!isVisible) {
    return null
  }

  return (
    <div
      className={`glass-effect rounded-lg p-4 transition-all ${
        isDeleting ? 'opacity-50 pointer-events-none' : ''
      }`}
    >
      {/* –û—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ */}
      <button onClick={handleDelete}>
        <Trash2 className="w-4 h-4" />
      </button>

      {/* üéØ –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä —É–¥–∞–ª–µ–Ω–∏—è */}
      {isDeleting && (
        <div className="absolute inset-0 flex items-center justify-center bg-white/50 dark:bg-black/50">
          <Loader2 className="w-6 h-6 animate-spin" />
        </div>
      )}

      {/* üéØ –û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è */}
      {deleteError && (
        <div className="text-red-500 text-xs mt-2">
          –ù–µ —É–¥–∞–ª–æ—Å—å —É–¥–∞–ª–∏—Ç—å –∑–∞–ø–∏—Å—å. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.
        </div>
      )}
    </div>
  )
})
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –ó–∞–ø–∏—Å—å –∏—Å—á–µ–∑–∞–µ—Ç **–º–≥–Ω–æ–≤–µ–Ω–Ω–æ** –ø–æ—Å–ª–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
- ‚úÖ –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ–∫–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —É–¥–∞–ª–µ–Ω–∏–µ
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –æ—Ç–∫–∞—Ç –µ—Å–ª–∏ –æ–ø–µ—Ä–∞—Ü–∏—è –ø—Ä–æ–≤–∞–ª–∏–ª–∞—Å—å
- ‚úÖ –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –æ—à–∏–±–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é

---

### –ü—Ä–∏–º–µ—Ä 2: Optimistic Update –≤ `EditEntryModal.tsx`

#### –î–æ (—Ç–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è):

```tsx
// src/components/modals/EditEntryModal.tsx
const handleSave = useCallback(() => {
  if (!validateForm()) return

  const saveData = {
    // ... –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö
  }

  triggerHaptic('success')
  onSave(saveData) // ‚ùå –°–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
  onClose()
}, [formData, effectiveEntry])
```

**–ü—Ä–æ–±–ª–µ–º–∞:** –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è —Å—Ä–∞–∑—É, –Ω–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è –º–æ–≥—É—Ç –Ω–µ –ø—Ä–∏–º–µ–Ω—è—Ç—å—Å—è –º–≥–Ω–æ–≤–µ–Ω–Ω–æ –≤ —Å–ø–∏—Å–∫–µ.

---

#### –ü–æ—Å–ª–µ (—Å Optimistic UI):

```tsx
// src/components/modals/EditEntryModal.tsx
import { useOptimisticUpdate } from '../../hooks/useOptimisticUpdate'

export function EditEntryModal({ isOpen, onClose, entry, onSave }) {
  // ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ ...

  // üéØ –ù–û–í–û–ï: Optimistic state –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
  const {
    value: savedData,
    isPending: isSaving,
    error: saveError,
    update: optimisticSave,
  } = useOptimisticUpdate(null)

  const handleSave = useCallback(async () => {
    if (!validateForm()) return

    const saveData = {
      date: formData.date || effectiveEntry?.date || getTodayString(),
      start: formData.start,
      end: formData.end,
      category: formData.category,
      categoryId,
      description: formData.description || '',
      duration: parseFloat(duration),
      earned: earnedValue,
      rate: parseFloat(rate.toFixed(2)),
      isManual: true,
    }

    if (effectiveEntry?.id) {
      saveData.id = String(effectiveEntry.id)
      saveData.createdAt = effectiveEntry.createdAt
      saveData.updatedAt = new Date().toISOString()
    }

    try {
      // üéØ Optimistic update: —Å—Ä–∞–∑—É –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è
      await optimisticSave(
        saveData, // –û–ø—Ç–∏–º–∏—Å—Ç–∏—á–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ - –Ω–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
        async () => {
          // –§–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ —Ñ–æ–Ω–µ
          await onSave(saveData)
          return saveData // –§–∏–Ω–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
        }
      )

      triggerHaptic('success')
      onClose()
    } catch (error) {
      // ‚ùå –ï—Å–ª–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–≤–∞–ª–∏–ª–æ—Å—å, –¥–∞–Ω–Ω—ã–µ –æ—Ç–∫–∞—Ç—è—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
      console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏:', error)
      triggerHaptic('error')
      // –ù–µ –∑–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ, —á—Ç–æ–±—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–≥ –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞
    }
  }, [formData, effectiveEntry, validateForm, onSave, onClose])

  return (
    <BaseModal
      isOpen={isOpen}
      onClose={onClose}
      title={modalTitle}
      footer={
        <EntryFormActions
          onSave={handleSave}
          onClose={onClose}
          onDelete={handleDelete}
          effectiveEntry={effectiveEntry}
          isSaving={isSaving} // üéØ –ü–µ—Ä–µ–¥–∞–µ–º —Å—Ç–∞—Ç—É—Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
        />
      }
    >
      {/* –§–æ—Ä–º–∞ */}
      <EntryFormFields {...props} disabled={isSaving} />

      {/* üéØ –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è */}
      {isSaving && (
        <div className="text-blue-500 text-sm flex items-center gap-2">
          <Loader2 className="w-4 h-4 animate-spin" />
          <span>–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ...</span>
        </div>
      )}

      {/* üéØ –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è */}
      {saveError && (
        <div className="text-red-500 text-sm mt-2">
          –ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –∑–∞–ø–∏—Å—å. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–∞–Ω–Ω—ã–µ –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.
        </div>
      )}
    </BaseModal>
  )
}
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –§–æ—Ä–º–∞ –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è –≤–æ –≤—Ä–µ–º—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è (–ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –¥–≤–æ–π–Ω—É—é –æ—Ç–ø—Ä–∞–≤–∫—É)
- ‚úÖ –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä "–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ..."
- ‚úÖ –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –Ω–µ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –æ—à–∏–±–∫–µ
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –æ—Ç–∫–∞—Ç –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –æ—à–∏–±–∫–µ

---

### –ü—Ä–∏–º–µ—Ä 3: Optimistic Bulk Delete –≤ `BulkActionsPanel.tsx`

```tsx
// src/components/entries/BulkActionsPanel.tsx
import { useOptimisticUpdate } from '../../hooks/useOptimisticUpdate'

export function BulkActionsPanel({ selectedIds, onClearSelection }) {
  const bulkDeleteEntries = useBulkDeleteEntries()
  const triggerHaptic = useHapticFeedback()

  // üéØ –ù–û–í–û–ï: Optimistic state –¥–ª—è –º–∞—Å—Å–æ–≤–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è
  const {
    value: deletedIds,
    isPending: isDeleting,
    error: deleteError,
    update: optimisticBulkDelete,
  } = useOptimisticUpdate(new Set())

  const handleBulkDelete = async () => {
    try {
      triggerHaptic('heavy')

      // üéØ Optimistic update: —Å—Ä–∞–∑—É –ø–æ–º–µ—á–∞–µ–º –∑–∞–ø–∏—Å–∏ –∫–∞–∫ —É–¥–∞–ª–µ–Ω–Ω—ã–µ
      await optimisticBulkDelete(
        new Set(selectedIds), // –û–ø—Ç–∏–º–∏—Å—Ç–∏—á–Ω–æ —É–¥–∞–ª—è–µ–º –≤—Å–µ –≤—ã–±—Ä–∞–Ω–Ω—ã–µ
        async () => {
          // –§–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –≤ —Ñ–æ–Ω–µ
          await bulkDeleteEntries(selectedIds)
          return new Set(selectedIds)
        }
      )

      onClearSelection()
    } catch (error) {
      console.error('–û—à–∏–±–∫–∞ –º–∞—Å—Å–æ–≤–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è:', error)
      triggerHaptic('error')
    }
  }

  return (
    <div className="flex gap-2">
      <button
        onClick={handleBulkDelete}
        disabled={isDeleting}
        className="btn-danger"
      >
        {isDeleting ? (
          <>
            <Loader2 className="w-4 h-4 animate-spin" />
            <span>–£–¥–∞–ª–µ–Ω–∏–µ {selectedIds.length} –∑–∞–ø–∏—Å–µ–π...</span>
          </>
        ) : (
          <>
            <Trash2 className="w-4 h-4" />
            <span>–£–¥–∞–ª–∏—Ç—å ({selectedIds.length})</span>
          </>
        )}
      </button>

      {deleteError && (
        <div className="text-red-500 text-sm">
          –ù–µ —É–¥–∞–ª–æ—Å—å —É–¥–∞–ª–∏—Ç—å –∑–∞–ø–∏—Å–∏. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.
        </div>
      )}
    </div>
  )
}
```

---

## üîÑ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º store

–í–∞–∂–Ω–æ —É—á–∏—Ç—ã–≤–∞—Ç—å, —á—Ç–æ —Ç–µ–∫—É—â–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ `deleteEntry`, `updateEntry` **—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ**. –î–ª—è –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–æ–π —Ä–∞–±–æ—Ç—ã Optimistic UI –Ω—É–∂–Ω–æ:

### –í–∞—Ä–∏–∞–Ω—Ç 1: –û–±–µ—Ä–Ω—É—Ç—å –≤ Promise (–ø—Ä–æ—Å—Ç–æ–π)

```tsx
const handleDelete = async () => {
  await optimisticDelete(false, async () => {
    // –û–±–æ—Ä–∞—á–∏–≤–∞–µ–º —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –≤—ã–∑–æ–≤ –≤ Promise
    return new Promise((resolve) => {
      deleteEntry(entry.id)
      // –î–∞–µ–º –≤—Ä–µ–º—è –Ω–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ store (setState –∞—Å–∏–Ω—Ö—Ä–æ–Ω–µ–Ω)
      setTimeout(() => resolve(false), 50)
    })
  })
}
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å store (—Å–ª–æ–∂–Ω–µ–µ, –Ω–æ –ø—Ä–∞–≤–∏–ª—å–Ω–µ–µ)

–°–¥–µ–ª–∞—Ç—å `deleteEntry`, `updateEntry` –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–º–∏:

```typescript
// src/store/useEntriesStore.ts
deleteEntry: async (id) => {
  const currentEntries = get().entries
  useHistoryStore.getState().pushToUndo(currentEntries, '–£–¥–∞–ª–µ–Ω–∞ –∑–∞–ø–∏—Å—å')

  const idString = String(id)
  const updatedEntries = currentEntries.filter(e => String(e.id) !== idString)

  // –í–æ–∑–≤—Ä–∞—â–∞–µ–º Promise –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ —Å Optimistic UI
  return new Promise((resolve) => {
    set({ entries: updatedEntries }, false, 'deleteEntry')
    scheduleBackup()

    syncManager.broadcastMessage({
      type: SyncMessageType.ENTRY_DELETED,
      payload: { id: idString },
    })

    logger.info(`–ó–∞–ø–∏—Å—å ${idString} —É–¥–∞–ª–µ–Ω–∞`)
    resolve(true)
  })
},
```

---

## üìä –°—Ä–∞–≤–Ω–µ–Ω–∏–µ: –î–æ –∏ –ü–æ—Å–ª–µ

| –ê—Å–ø–µ–∫—Ç | –î–æ (—Ç–µ–∫—É—â–µ–µ) | –ü–æ—Å–ª–µ (—Å Optimistic UI) |
|--------|-------------|-------------------------|
| **–°–∫–æ—Ä–æ—Å—Ç—å UI** | –ó–∞–¥–µ—Ä–∂–∫–∞ –¥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –æ–ø–µ—Ä–∞—Ü–∏–∏ | –ú–≥–Ω–æ–≤–µ–Ω–Ω–∞—è —Ä–µ–∞–∫—Ü–∏—è |
| **UX** | –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∂–¥–µ—Ç | –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Å—Ä–∞–∑—É |
| **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫** | –û—à–∏–±–∫–∞ –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ–∑–∞–º–µ—Ç–Ω–∞ | –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –æ—Ç–∫–∞—Ç + —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ |
| **–°–ª–æ–∂–Ω–æ—Å—Ç—å –∫–æ–¥–∞** | –ü—Ä–æ—Å—Ç–æ–π | –ù–µ–º–Ω–æ–≥–æ —Å–ª–æ–∂–Ω–µ–µ (–Ω–æ –ª—É—á—à–µ UX) |
| **–ò–Ω–¥–∏–∫–∞—Ü–∏—è –ø—Ä–æ—Ü–µ—Å—Å–∞** | –ù–µ—Ç | –ï—Å—Ç—å (`isPending`) |

---

## ‚úÖ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –≤–Ω–µ–¥—Ä–µ–Ω–∏—é

### –≠—Ç–∞–ø 1: –ü—Ä–æ—Å—Ç–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è (1-2 —á–∞—Å–∞)
1. –î–æ–±–∞–≤–∏—Ç—å Optimistic UI –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è –≤ `EntryItem.tsx`
2. –î–æ–±–∞–≤–∏—Ç—å –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã –∑–∞–≥—Ä—É–∑–∫–∏
3. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ –º–µ–¥–ª–µ–Ω–Ω–æ–º —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–∏ (Chrome DevTools > Network > Slow 3G)

### –≠—Ç–∞–ø 2: –ü–æ–ª–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è (3-4 —á–∞—Å–∞)
1. –î–æ–±–∞–≤–∏—Ç—å Optimistic UI –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤ `EditEntryModal.tsx`
2. –î–æ–±–∞–≤–∏—Ç—å Optimistic UI –¥–ª—è –º–∞—Å—Å–æ–≤–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è –≤ `BulkActionsPanel.tsx`
3. –ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å store –¥–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞ Promise

### –≠—Ç–∞–ø 3: –ü–æ–ª–∏—Ä–æ–≤–∫–∞ (1-2 —á–∞—Å–∞)
1. –î–æ–±–∞–≤–∏—Ç—å –∞–Ω–∏–º–∞—Ü–∏–∏ –ø–æ—è–≤–ª–µ–Ω–∏—è/–∏—Å—á–µ–∑–Ω–æ–≤–µ–Ω–∏—è
2. –£–ª—É—á—à–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö
3. –î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç—ã –¥–ª—è Optimistic UI —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ö–∞–∫ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å Optimistic UI:

1. **–ù–æ—Ä–º–∞–ª—å–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π:**
   - –£–¥–∞–ª–∏—Ç—å –∑–∞–ø–∏—Å—å ‚Üí –æ–Ω–∞ –∏—Å—á–µ–∑–∞–µ—Ç –º–≥–Ω–æ–≤–µ–Ω–Ω–æ
   - –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∑–∞–ø–∏—Å—å ‚Üí –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤–∏–¥–Ω—ã —Å—Ä–∞–∑—É

2. **–°—Ü–µ–Ω–∞—Ä–∏–π —Å –æ—à–∏–±–∫–æ–π:**
   - –í `deleteEntry` –¥–æ–±–∞–≤–∏—Ç—å `throw new Error('Test error')`
   - –£–¥–∞–ª–∏—Ç—å –∑–∞–ø–∏—Å—å ‚Üí –æ–Ω–∞ –∏—Å—á–µ–∑–∞–µ—Ç ‚Üí –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è —Å –æ—à–∏–±–∫–æ–π

3. **–ú–µ–¥–ª–µ–Ω–Ω–æ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ:**
   - Chrome DevTools > Network > Slow 3G
   - –£–¥–∞–ª–∏—Ç—å –∑–∞–ø–∏—Å—å ‚Üí –≤–∏–¥–µ—Ç—å –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
   - –ó–∞–ø–∏—Å—å –æ—Å—Ç–∞–µ—Ç—Å—è —Å–∫—Ä—ã—Ç–æ–π –ø–æ–∫–∞ –∏–¥–µ—Ç —É–¥–∞–ª–µ–Ω–∏–µ

---

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

- [React Query - Optimistic Updates](https://tanstack.com/query/latest/docs/react/guides/optimistic-updates)
- [SWR - Optimistic UI](https://swr.vercel.app/docs/mutation#optimistic-updates)
- [When to Use Optimistic UI](https://www.nngroup.com/articles/optimistic-ui/)

---

## üéØ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

**–ó–∞–¥–∞—á–∞ 2.3.4** –æ—Ç–º–µ—á–µ–Ω–∞ –∫–∞–∫ "‚úÖ –í–´–ü–û–õ–ù–ï–ù–û", –Ω–æ –Ω–∞ —Å–∞–º–æ–º –¥–µ–ª–µ:

- ‚úÖ –•—É–∫ —Å–æ–∑–¥–∞–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚ùå –•—É–∫ –ù–ï –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω –≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
- ‚ùå Optimistic UI –ù–ï —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å –∑–∞–¥–∞—á–∏ –Ω–∞ "üîÑ –í –ü–†–û–¶–ï–°–°–ï" –∏–ª–∏ –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–¥–∑–∞–¥–∞—á—É:
- [x] 2.3.4.1 –°–æ–∑–¥–∞—Ç—å —Ö—É–∫ useOptimisticUpdate
- [ ] 2.3.4.2 –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –≤ EntryItem (delete)
- [ ] 2.3.4.3 –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –≤ EditEntryModal (save)
- [ ] 2.3.4.4 –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –≤ BulkActionsPanel (bulk delete)
