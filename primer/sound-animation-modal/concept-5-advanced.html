<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Концепт 5 - Продвинутый</title>
  <script src="shared-functionality.js"></script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }
    
    .modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.6);
      backdrop-filter: blur(8px);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 50;
      animation: fadeIn 0.3s ease-out;
    }
    
    .modal-content {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(16px);
      border: 1px solid rgba(255, 255, 255, 0.2);
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
      border-radius: 12px;
      padding: 0;
      max-width: 896px;
      width: 100%;
      max-height: 90vh;
      display: flex;
      flex-direction: column;
      animation: slideUp 0.4s ease-out;
    }
    
    .dark .modal-content {
      background: rgba(31, 41, 55, 0.95);
      border: 1px solid rgba(75, 85, 99, 0.2);
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
    }
    
    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      padding: 24px;
      border-bottom: 1px solid rgba(0, 0, 0, 0.1);
    }
    
    .dark .modal-header {
      border-bottom-color: rgba(255, 255, 255, 0.1);
    }
    
    .header-left {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    .header-icon {
      width: 40px;
      height: 40px;
      background: rgba(59, 130, 246, 0.15);
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #3b82f6;
    }
    
    .modal-title {
      color: #111827;
      font-size: 24px;
      font-weight: 700;
      margin-bottom: 4px;
    }
    
    .dark .modal-title {
      color: white;
    }
    
    .modal-subtitle {
      color: #6b7280;
      font-size: 14px;
    }
    
    .dark .modal-subtitle {
      color: #9ca3af;
    }
    
    .close-btn {
      background: rgba(0, 0, 0, 0.05);
      border: none;
      color: #6b7280;
      cursor: pointer;
      padding: 8px;
      border-radius: 8px;
      transition: all 0.2s;
    }
    
    .dark .close-btn {
      background: rgba(255, 255, 255, 0.05);
      color: #9ca3af;
    }
    
    .close-btn:hover {
      background: rgba(0, 0, 0, 0.1);
      color: #111827;
    }
    
    .dark .close-btn:hover {
      background: rgba(255, 255, 255, 0.1);
      color: white;
    }
    
    .tabs {
      display: flex;
      gap: 8px;
      padding: 0 24px;
      border-bottom: 1px solid rgba(0, 0, 0, 0.1);
    }
    
    .dark .tabs {
      border-bottom-color: rgba(255, 255, 255, 0.1);
    }
    
    .tab {
      background: none;
      border: none;
      color: #6b7280;
      padding: 12px 20px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 600;
      border-bottom: 2px solid transparent;
      transition: all 0.2s;
    }
    
    .dark .tab {
      color: #9ca3af;
    }
    
    .tab:hover {
      color: #374151;
    }
    
    .dark .tab:hover {
      color: #e5e7eb;
    }
    
    .tab.active {
      color: #3b82f6;
      border-bottom-color: #3b82f6;
    }
    
    .dark .tab.active {
      color: #60a5fa;
      border-bottom-color: #60a5fa;
    }
    
    .modal-body {
      flex: 1;
      overflow-y: auto;
      padding: 24px;
    }
    
    .tab-content {
      display: none;
    }
    
    .tab-content.active {
      display: block;
    }
    
    .sound-list, .option-list {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }
    
    .sound-item, .option-item {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(16px);
      border: 1px solid rgba(255, 255, 255, 0.2);
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
      border-radius: 12px;
      padding: 16px;
      border-left: 4px solid;
      transition: all 0.3s ease;
    }
    
    .dark .sound-item, .dark .option-item {
      background: rgba(31, 41, 55, 0.95);
      border: 1px solid rgba(75, 85, 99, 0.2);
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
    }
    
    .sound-item:hover, .option-item:hover {
      background: rgba(255, 255, 255, 0.2);
      box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
    }
    
    .dark .sound-item:hover, .dark .option-item:hover {
      background: rgba(31, 41, 55, 0.8);
    }
    
    .sound-content, .option-content {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 16px;
    }
    
    .sound-main, .option-main {
      display: flex;
      align-items: center;
      gap: 12px;
      flex: 1;
      min-width: 0;
    }
    
    .sound-icon, .option-icon {
      width: 40px;
      height: 40px;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
    }
    
    .sound-details, .option-details {
      flex: 1;
      min-width: 0;
    }
    
    .sound-title, .option-title {
      font-size: 14px;
      font-weight: 600;
      color: #111827;
      margin-bottom: 4px;
    }
    
    .dark .sound-title, .dark .option-title {
      color: white;
    }
    
    .option-desc {
      font-size: 12px;
      color: #6b7280;
    }
    
    .dark .option-desc {
      color: #9ca3af;
    }
    
    .sound-controls {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    .volume-slider {
      flex: 1;
      height: 6px;
      background: #e5e7eb;
      border-radius: 3px;
      appearance: none;
      cursor: pointer;
      outline: none;
    }
    
    .dark .volume-slider {
      background: #374151;
    }
    
    .volume-slider::-webkit-slider-thumb {
      appearance: none;
      width: 16px;
      height: 16px;
      background: #3b82f6;
      border-radius: 50%;
      cursor: pointer;
    }
    
    .volume-slider::-moz-range-thumb {
      width: 16px;
      height: 16px;
      background: #3b82f6;
      border-radius: 50%;
      cursor: pointer;
      border: none;
    }
    
    .volume-value {
      font-size: 12px;
      color: #6b7280;
      min-width: 40px;
      text-align: right;
    }
    
    .dark .volume-value {
      color: #9ca3af;
    }
    
    .sound-actions {
      display: flex;
      align-items: center;
      gap: 8px;
      flex-shrink: 0;
    }
    
    .play-btn {
      background: rgba(59, 130, 246, 0.15);
      border: 1px solid rgba(59, 130, 246, 0.3);
      color: #3b82f6;
      width: 32px;
      height: 32px;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .play-btn:hover {
      background: rgba(59, 130, 246, 0.25);
      transform: translateY(-2px);
    }
    
    .toggle-switch {
      position: relative;
      width: 44px;
      height: 24px;
      background: #4B5563;
      border-radius: 12px;
      cursor: pointer;
      transition: background 0.3s ease;
    }
    
    .toggle-switch.active {
      background: #10B981;
    }
    
    .toggle-switch::after {
      content: '';
      position: absolute;
      top: 2px;
      left: 2px;
      width: 20px;
      height: 20px;
      background: white;
      border-radius: 50%;
      transition: transform 0.3s ease;
    }
    
    .toggle-switch.active::after {
      transform: translateX(20px);
    }
    
    .master-volume {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(16px);
      border: 1px solid rgba(255, 255, 255, 0.2);
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
      border-radius: 12px;
      padding: 20px;
      margin-top: 24px;
    }
    
    .dark .master-volume {
      background: rgba(31, 41, 55, 0.95);
      border: 1px solid rgba(75, 85, 99, 0.2);
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
    }
    
    .master-volume-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 16px;
    }
    
    .master-volume-label {
      font-size: 14px;
      font-weight: 600;
      color: #111827;
    }
    
    .dark .master-volume-label {
      color: white;
    }
    
    .master-volume-value {
      font-size: 18px;
      font-weight: 700;
      color: #3b82f6;
    }
    
    .master-slider {
      width: 100%;
      height: 8px;
      background: #e5e7eb;
      border-radius: 4px;
      appearance: none;
      cursor: pointer;
      outline: none;
    }
    
    .dark .master-slider {
      background: #374151;
    }
    
    .master-slider::-webkit-slider-thumb {
      appearance: none;
      width: 20px;
      height: 20px;
      background: #3b82f6;
      border-radius: 50%;
      cursor: pointer;
    }
    
    .master-slider::-moz-range-thumb {
      width: 20px;
      height: 20px;
      background: #3b82f6;
      border-radius: 50%;
      cursor: pointer;
      border: none;
    }
    
    .modal-footer {
      display: flex;
      gap: 12px;
      padding: 20px 24px;
      border-top: 1px solid rgba(0, 0, 0, 0.1);
    }
    
    .dark .modal-footer {
      border-top-color: rgba(255, 255, 255, 0.1);
    }
    
    .btn {
      flex: 1;
      padding: 12px 24px;
      border-radius: 12px;
      border: none;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      font-size: 14px;
    }
    
    .btn-cancel {
      background: #e5e7eb;
      color: #374151;
    }
    
    .dark .btn-cancel {
      background: #374151;
      color: #e5e7eb;
    }
    
    .btn-cancel:hover {
      background: #d1d5db;
    }
    
    .dark .btn-cancel:hover {
      background: #4b5563;
    }
    
    .btn-save {
      background: #3b82f6;
      color: white;
      backdrop-filter: blur(16px);
      border: 1px solid rgba(255, 255, 255, 0.3);
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
    }
    
    .dark .btn-save {
      border: 1px solid rgba(75, 85, 99, 0.3);
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.3);
    }
    
    .btn-save:hover {
      background: #2563eb;
      transform: translateY(-2px);
      box-shadow: 0 8px 24px rgba(59, 130, 246, 0.3);
    }
    
    .w-5 { width: 1.25rem; }
    .h-5 { height: 1.25rem; }
    .w-4 { width: 1rem; }
    .h-4 { height: 1rem; }
    
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    
    @keyframes slideUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
  </style>
</head>
<body>
  <div id="modal" class="modal-overlay">
    <div class="modal-content">
      <div class="modal-header">
        <div class="header-left">
          <div class="header-icon">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z"/>
            </svg>
          </div>
          <div>
            <h2 class="modal-title">Звуки и анимация</h2>
            <p class="modal-subtitle">Настройте звуковые уведомления и анимации</p>
          </div>
        </div>
        <button onclick="closeModal()" class="close-btn">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
          </svg>
        </button>
      </div>

      <div class="tabs">
        <button onclick="switchTab('sounds')" class="tab active" data-tab="sounds">Звуки</button>
        <button onclick="switchTab('animations')" class="tab" data-tab="animations">Анимации</button>
        <button onclick="switchTab('notifications')" class="tab" data-tab="notifications">Уведомления</button>
      </div>

      <div class="modal-body">
        <div id="tab-sounds" class="tab-content active">
          <div class="sound-list" id="sound-list">
            <!-- Звуки будут добавлены через JavaScript -->
          </div>
          <div class="master-volume">
            <div class="master-volume-header">
              <label class="master-volume-label">Общая громкость</label>
              <span id="master-volume-value" class="master-volume-value">80%</span>
            </div>
            <input
              type="range"
              id="master-slider"
              min="0"
              max="100"
              value="80"
              class="master-slider"
            />
          </div>
        </div>

        <div id="tab-animations" class="tab-content">
          <div class="option-list" id="animations-list">
            <!-- Анимации будут добавлены через JavaScript -->
          </div>
        </div>

        <div id="tab-notifications" class="tab-content">
          <div class="option-list" id="notifications-list">
            <!-- Уведомления будут добавлены через JavaScript -->
          </div>
        </div>
      </div>

      <div class="modal-footer">
        <button onclick="closeModal()" class="btn btn-cancel">Отмена</button>
        <button onclick="saveSettings()" class="btn btn-save">Сохранить все</button>
      </div>
    </div>
  </div>

  <script>
    const soundTypes = [
      { key: 'timerStart', name: 'Старт таймера', icon: 'M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z', color: '#3b82f6' },
      { key: 'timerStop', name: 'Стоп таймера', icon: 'M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z', color: '#ef4444' },
      { key: 'hourly', name: 'Каждый час', icon: 'M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9', color: '#10b981' },
      { key: 'achievement', name: 'Достижение', icon: 'M9 12l2 2 4-4M7.835 4.697a3.42 3.42 0 001.946-.806 3.42 3.42 0 014.438 0 3.42 3.42 0 001.946.806 3.42 3.42 0 013.138 3.138 3.42 3.42 0 00.806 1.946 3.42 3.42 0 010 4.438 3.42 3.42 0 00-.806 1.946 3.42 3.42 0 01-3.138 3.138 3.42 3.42 0 00-1.946.806 3.42 3.42 0 01-4.438 0 3.42 3.42 0 00-1.946-.806 3.42 3.42 0 01-3.138-3.138 3.42 3.42 0 00-.806-1.946 3.42 3.42 0 010-4.438 3.42 3.42 0 00.806-1.946 3.42 3.42 0 013.138-3.138z', color: '#f59e0b' },
      { key: 'error', name: 'Ошибка', icon: 'M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z', color: '#ef4444' },
      { key: 'notification', name: 'Уведомление', icon: 'M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9', color: '#8b5cf6' },
      { key: 'success', name: 'Успех', icon: 'M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z', color: '#10b981' },
      { key: 'warning', name: 'Предупреждение', icon: 'M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z', color: '#f59e0b' }
    ];

    const animations = [
      { key: 'favicon', name: 'Анимация фавикона', icon: 'M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z', desc: 'Пульсирующий фавикон при работе таймера', color: '#8b5cf6' },
      { key: 'transitions', name: 'Плавные переходы', icon: 'M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z', desc: 'Анимации между страницами', color: '#8b5cf6' },
      { key: 'hover', name: 'Эффекты наведения', icon: 'M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zm0 0h12a2 2 0 002-2v-4a2 2 0 00-2-2h-2.343M11 7.343l1.657-1.657a2 2 0 012.828 0l2.829 2.829a2 2 0 010 2.828l-8.486 8.485M7 17h.01', desc: 'Подсветка элементов при наведении', color: '#8b5cf6' },
      { key: 'loading', name: 'Индикаторы загрузки', icon: 'M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15', desc: 'Вращающиеся спиннеры', color: '#8b5cf6' }
    ];

    const notifications = [
      { key: 'browser', name: 'Браузерные уведомления', icon: 'M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9', desc: 'Системные уведомления браузера', color: '#10b981' },
      { key: 'entryComplete', name: 'Завершение записи', icon: 'M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z', desc: 'При остановке таймера', color: '#10b981' },
      { key: 'achievements', name: 'Достижения', icon: 'M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z', desc: 'Выполнение целей и планов', color: '#10b981' },
      { key: 'reminders', name: 'Напоминания', icon: 'M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z', desc: 'Перерывы и важные события', color: '#10b981' }
    ];

    let settings = {
      sounds: {},
      animations: {},
      notifications: {},
      masterVolume: 80
    };

    function loadSettings() {
      const saved = localStorage.getItem('soundSettings');
      if (saved) {
        settings = JSON.parse(saved);
      } else {
        soundTypes.forEach(sound => {
          settings.sounds[sound.key] = {
            enabled: ['timerStart', 'timerStop', 'achievement', 'error', 'success', 'warning'].includes(sound.key),
            volume: 80
          };
        });
        animations.forEach(anim => {
          settings.animations[anim.key] = true;
        });
        notifications.forEach(notif => {
          settings.notifications[notif.key] = ['entryComplete', 'achievements'].includes(notif.key);
        });
      }
      renderSounds();
      renderAnimations();
      renderNotifications();
      updateMasterVolume();
    }

    function renderSounds() {
      const container = document.getElementById('sound-list');
      container.innerHTML = soundTypes.map(sound => {
        const soundSetting = settings.sounds[sound.key] || { enabled: false, volume: 80 };
        return `
          <div class="sound-item" style="border-left-color: ${sound.color}">
            <div class="sound-content">
              <div class="sound-main">
                <div class="sound-icon" style="background-color: ${sound.color}20; color: ${sound.color}">
                  <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="${sound.icon}"/>
                  </svg>
                </div>
                <div class="sound-details">
                  <h3 class="sound-title">${sound.name}</h3>
                  <div class="sound-controls">
                    <input
                      type="range"
                      min="0"
                      max="100"
                      value="${soundSetting.volume}"
                      oninput="updateVolume('${sound.key}', this.value)"
                      class="volume-slider"
                      style="background: linear-gradient(to right, ${sound.color} 0%, ${sound.color} ${soundSetting.volume}%, #e5e7eb ${soundSetting.volume}%, #e5e7eb 100%)"
                    />
                    <span class="volume-value">${soundSetting.volume}%</span>
                  </div>
                </div>
              </div>
              <div class="sound-actions">
                <button onclick="playSoundLocal('${sound.key}')" class="play-btn" title="Воспроизвести">
                  <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M8 5v14l11-7z"/>
                  </svg>
                </button>
                <div onclick="toggleSound('${sound.key}')" class="toggle-switch ${soundSetting.enabled ? 'active' : ''}"></div>
              </div>
            </div>
          </div>
        `;
      }).join('');
    }

    function renderAnimations() {
      const container = document.getElementById('animations-list');
      container.innerHTML = animations.map(anim => {
        const enabled = settings.animations[anim.key] !== false;
        return `
          <div class="option-item" style="border-left-color: ${anim.color}">
            <div class="option-content">
              <div class="option-main">
                <div class="option-icon" style="background-color: ${anim.color}20; color: ${anim.color}">
                  <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="${anim.icon}"/>
                  </svg>
                </div>
                <div class="option-details">
                  <h3 class="option-title">${anim.name}</h3>
                  <p class="option-desc">${anim.desc}</p>
                </div>
              </div>
              <div onclick="toggleAnimation('${anim.key}')" class="toggle-switch ${enabled ? 'active' : ''}"></div>
            </div>
          </div>
        `;
      }).join('');
    }

    function renderNotifications() {
      const container = document.getElementById('notifications-list');
      container.innerHTML = notifications.map(notif => {
        const enabled = settings.notifications[notif.key] === true;
        return `
          <div class="option-item" style="border-left-color: ${notif.color}">
            <div class="option-content">
              <div class="option-main">
                <div class="option-icon" style="background-color: ${notif.color}20; color: ${notif.color}">
                  <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="${notif.icon}"/>
                  </svg>
                </div>
                <div class="option-details">
                  <h3 class="option-title">${notif.name}</h3>
                  <p class="option-desc">${notif.desc}</p>
                </div>
              </div>
              <div onclick="toggleNotification('${notif.key}')" class="toggle-switch ${enabled ? 'active' : ''}"></div>
            </div>
          </div>
        `;
      }).join('');
    }

    function switchTab(tabName) {
      document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
      document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
      
      document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');
      document.getElementById(`tab-${tabName}`).classList.add('active');
    }

    function updateVolume(key, value) {
      if (!settings.sounds[key]) {
        settings.sounds[key] = { enabled: false, volume: 80 };
      }
      settings.sounds[key].volume = parseInt(value);
      const slider = event.target;
      slider.style.background = `linear-gradient(to right, ${soundTypes.find(s => s.key === key).color} 0%, ${soundTypes.find(s => s.key === key).color} ${value}%, #e5e7eb ${value}%, #e5e7eb 100%)`;
      slider.nextElementSibling.textContent = value + '%';
    }

    function toggleSound(key) {
      if (!settings.sounds[key]) {
        settings.sounds[key] = { enabled: false, volume: 80 };
      }
      settings.sounds[key].enabled = !settings.sounds[key].enabled;
      const switchEl = event.target;
      switchEl.classList.toggle('active');
    }

    function toggleAnimation(key) {
      settings.animations[key] = !settings.animations[key];
      const switchEl = event.target;
      switchEl.classList.toggle('active');
    }

    function toggleNotification(key) {
      settings.notifications[key] = !settings.notifications[key];
      const switchEl = event.target;
      switchEl.classList.toggle('active');
    }

    function playSoundLocal(key) {
      const sound = soundEffects[key];
      if (!sound) return;
      
      const soundSetting = settings.sounds[key] || { volume: 80 };
      const volume = (soundSetting.volume / 100) * 0.3;
      
      if (typeof playSound === 'function') {
        playSound(key, volume);
      }
    }

    function updateMasterVolume() {
      const slider = document.getElementById('master-slider');
      const valueEl = document.getElementById('master-volume-value');
      
      slider.addEventListener('input', function(e) {
        const value = e.target.value;
        settings.masterVolume = parseInt(value);
        valueEl.textContent = value + '%';
        slider.style.background = `linear-gradient(to right, #3b82f6 0%, #3b82f6 ${value}%, #e5e7eb ${value}%, #e5e7eb 100%)`;
      });
    }

    function saveSettings() {
      localStorage.setItem('soundSettings', JSON.stringify(settings));
      if (typeof showNotification === 'function') {
        showNotification('Настройки сохранены', 'success');
      }
      closeModal();
    }

    function closeModal() {
      const modal = document.getElementById('modal');
      modal.style.animation = 'fadeIn 0.2s ease-out reverse';
      setTimeout(() => {
        modal.style.display = 'none';
      }, 200);
    }

    loadSettings();
  </script>
</body>
</html>

