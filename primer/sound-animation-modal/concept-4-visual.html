<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Концепт 4 - Визуальный</title>
  <script src="shared-functionality.js"></script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }
    
    .modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.6);
      backdrop-filter: blur(8px);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 50;
      animation: fadeIn 0.3s ease-out;
    }
    
    .modal-content {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(16px);
      border: 1px solid rgba(255, 255, 255, 0.2);
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
      border-radius: 12px;
      padding: 0;
      max-width: 896px;
      width: 100%;
      max-height: 90vh;
      display: flex;
      flex-direction: column;
      animation: slideUp 0.4s ease-out;
    }
    
    .dark .modal-content {
      background: rgba(31, 41, 55, 0.95);
      border: 1px solid rgba(75, 85, 99, 0.2);
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
    }
    
    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      padding: 24px;
      border-bottom: 1px solid rgba(0, 0, 0, 0.1);
    }
    
    .dark .modal-header {
      border-bottom-color: rgba(255, 255, 255, 0.1);
    }
    
    .header-left {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    .header-icon {
      width: 40px;
      height: 40px;
      background: rgba(59, 130, 246, 0.15);
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #3b82f6;
    }
    
    .modal-title {
      color: #111827;
      font-size: 24px;
      font-weight: 700;
      margin-bottom: 4px;
    }
    
    .dark .modal-title {
      color: white;
    }
    
    .modal-subtitle {
      color: #6b7280;
      font-size: 14px;
    }
    
    .dark .modal-subtitle {
      color: #9ca3af;
    }
    
    .close-btn {
      background: rgba(0, 0, 0, 0.05);
      border: none;
      color: #6b7280;
      cursor: pointer;
      padding: 8px;
      border-radius: 8px;
      transition: all 0.2s;
    }
    
    .dark .close-btn {
      background: rgba(255, 255, 255, 0.05);
      color: #9ca3af;
    }
    
    .close-btn:hover {
      background: rgba(0, 0, 0, 0.1);
      color: #111827;
    }
    
    .dark .close-btn:hover {
      background: rgba(255, 255, 255, 0.1);
      color: white;
    }
    
    .modal-body {
      flex: 1;
      overflow-y: auto;
      padding: 24px;
    }
    
    .sound-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 16px;
      margin-bottom: 24px;
    }
    
    .sound-card {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(16px);
      border: 1px solid rgba(255, 255, 255, 0.2);
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
      border-radius: 12px;
      padding: 16px;
      border-left: 4px solid;
      transition: all 0.3s ease;
      display: flex;
      flex-direction: column;
      position: relative;
      overflow: hidden;
    }
    
    .dark .sound-card {
      background: rgba(31, 41, 55, 0.95);
      border: 1px solid rgba(75, 85, 99, 0.2);
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
    }
    
    .sound-card:hover {
      background: rgba(255, 255, 255, 0.2);
      box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
      transform: translateY(-2px);
    }
    
    .dark .sound-card:hover {
      background: rgba(31, 41, 55, 0.8);
    }
    
    .card-bg {
      position: absolute;
      inset: 0;
      opacity: 0.1;
      transition: opacity 0.3s;
      pointer-events: none;
    }
    
    .sound-card:hover .card-bg {
      opacity: 0.2;
    }
    
    .card-content {
      position: relative;
      z-index: 1;
    }
    
    .card-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 12px;
    }
    
    .sound-icon {
      width: 48px;
      height: 48px;
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      transition: transform 0.3s;
    }
    
    .sound-icon.playing {
      transform: scale(1.1);
    }
    
    .glow-ring {
      position: absolute;
      inset: -4px;
      border-radius: 14px;
      border: 3px solid currentColor;
      opacity: 0;
      pointer-events: none;
    }
    
    .glow-ring.active {
      animation: pulse 0.8s ease-out;
    }
    
    .sound-title {
      font-size: 14px;
      font-weight: 600;
      color: #111827;
      margin-bottom: 4px;
    }
    
    .dark .sound-title {
      color: white;
    }
    
    .sound-desc {
      font-size: 12px;
      color: #6b7280;
      margin-bottom: 16px;
    }
    
    .dark .sound-desc {
      color: #9ca3af;
    }
    
    .wave-visual {
      display: flex;
      align-items: end;
      gap: 3px;
      height: 48px;
      margin-bottom: 16px;
      opacity: 0;
      transition: opacity 0.3s;
    }
    
    .wave-visual.active {
      opacity: 1;
    }
    
    .wave-line {
      flex: 1;
      border-radius: 3px;
      animation: waveAnimation 1.2s ease-in-out infinite;
    }
    
    .sound-controls {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 12px;
    }
    
    .volume-slider {
      flex: 1;
      height: 6px;
      background: #e5e7eb;
      border-radius: 3px;
      appearance: none;
      cursor: pointer;
      outline: none;
    }
    
    .dark .volume-slider {
      background: #374151;
    }
    
    .volume-slider::-webkit-slider-thumb {
      appearance: none;
      width: 12px;
      height: 12px;
      background: #3b82f6;
      border-radius: 50%;
      cursor: pointer;
    }
    
    .volume-slider::-moz-range-thumb {
      width: 12px;
      height: 12px;
      background: #3b82f6;
      border-radius: 50%;
      cursor: pointer;
      border: none;
    }
    
    .volume-value {
      font-size: 11px;
      color: #6b7280;
      min-width: 32px;
      text-align: right;
    }
    
    .dark .volume-value {
      color: #9ca3af;
    }
    
    .play-btn {
      width: 100%;
      background: rgba(59, 130, 246, 0.15);
      border: 1px solid rgba(59, 130, 246, 0.3);
      color: #3b82f6;
      padding: 8px 12px;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      cursor: pointer;
      transition: all 0.2s;
      font-size: 12px;
      font-weight: 500;
      margin-bottom: 8px;
    }
    
    .play-btn:hover {
      background: rgba(59, 130, 246, 0.25);
      transform: scale(1.02);
    }
    
    .toggle-switch {
      position: relative;
      width: 44px;
      height: 24px;
      background: #4B5563;
      border-radius: 12px;
      cursor: pointer;
      transition: background 0.3s ease;
    }
    
    .toggle-switch.active {
      background: #10B981;
    }
    
    .toggle-switch::after {
      content: '';
      position: absolute;
      top: 2px;
      left: 2px;
      width: 20px;
      height: 20px;
      background: white;
      border-radius: 50%;
      transition: transform 0.3s ease;
    }
    
    .toggle-switch.active::after {
      transform: translateX(20px);
    }
    
    .master-volume {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(16px);
      border: 1px solid rgba(255, 255, 255, 0.2);
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
      border-radius: 12px;
      padding: 20px;
    }
    
    .dark .master-volume {
      background: rgba(31, 41, 55, 0.95);
      border: 1px solid rgba(75, 85, 99, 0.2);
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
    }
    
    .master-volume-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 16px;
    }
    
    .master-volume-label {
      font-size: 14px;
      font-weight: 600;
      color: #111827;
    }
    
    .dark .master-volume-label {
      color: white;
    }
    
    .master-volume-value {
      font-size: 18px;
      font-weight: 700;
      color: #3b82f6;
    }
    
    .master-slider {
      width: 100%;
      height: 8px;
      background: #e5e7eb;
      border-radius: 4px;
      appearance: none;
      cursor: pointer;
      outline: none;
    }
    
    .dark .master-slider {
      background: #374151;
    }
    
    .master-slider::-webkit-slider-thumb {
      appearance: none;
      width: 20px;
      height: 20px;
      background: #3b82f6;
      border-radius: 50%;
      cursor: pointer;
    }
    
    .master-slider::-moz-range-thumb {
      width: 20px;
      height: 20px;
      background: #3b82f6;
      border-radius: 50%;
      cursor: pointer;
      border: none;
    }
    
    .modal-footer {
      display: flex;
      gap: 12px;
      padding: 20px 24px;
      border-top: 1px solid rgba(0, 0, 0, 0.1);
    }
    
    .dark .modal-footer {
      border-top-color: rgba(255, 255, 255, 0.1);
    }
    
    .btn {
      flex: 1;
      padding: 12px 24px;
      border-radius: 12px;
      border: none;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      font-size: 14px;
    }
    
    .btn-cancel {
      background: #e5e7eb;
      color: #374151;
    }
    
    .dark .btn-cancel {
      background: #374151;
      color: #e5e7eb;
    }
    
    .btn-cancel:hover {
      background: #d1d5db;
    }
    
    .dark .btn-cancel:hover {
      background: #4b5563;
    }
    
    .btn-save {
      background: #3b82f6;
      color: white;
      backdrop-filter: blur(16px);
      border: 1px solid rgba(255, 255, 255, 0.3);
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
    }
    
    .dark .btn-save {
      border: 1px solid rgba(75, 85, 99, 0.3);
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.3);
    }
    
    .btn-save:hover {
      background: #2563eb;
      transform: translateY(-2px);
      box-shadow: 0 8px 24px rgba(59, 130, 246, 0.3);
    }
    
    .w-5 { width: 1.25rem; }
    .h-5 { height: 1.25rem; }
    .w-4 { width: 1rem; }
    .h-4 { height: 1rem; }
    
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    
    @keyframes slideUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    @keyframes pulse {
      0%, 100% { transform: scale(1); opacity: 1; }
      50% { transform: scale(1.6); opacity: 0; }
    }
    
    @keyframes waveAnimation {
      0%, 100% { height: 25%; }
      50% { height: 100%; }
    }
  </style>
</head>
<body>
  <div id="modal" class="modal-overlay">
    <div class="modal-content">
      <div class="modal-header">
        <div class="header-left">
          <div class="header-icon">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z"/>
            </svg>
          </div>
          <div>
            <h2 class="modal-title">Звуки и анимация</h2>
            <p class="modal-subtitle">Настройте звуковые уведомления и анимации</p>
          </div>
        </div>
        <button onclick="closeModal()" class="close-btn">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
          </svg>
        </button>
      </div>

      <div class="modal-body">
        <div class="sound-grid" id="sound-grid">
          <!-- Звуки будут добавлены через JavaScript -->
        </div>

        <div class="master-volume">
          <div class="master-volume-header">
            <label class="master-volume-label">Общая громкость</label>
            <span id="master-volume-value" class="master-volume-value">80%</span>
          </div>
          <input
            type="range"
            id="master-slider"
            min="0"
            max="100"
            value="80"
            class="master-slider"
          />
        </div>
      </div>

      <div class="modal-footer">
        <button onclick="closeModal()" class="btn btn-cancel">Отмена</button>
        <button onclick="saveSettings()" class="btn btn-save">Сохранить все</button>
      </div>
    </div>
  </div>

  <script>
    const soundTypes = [
      { key: 'timerStart', name: 'Старт таймера', icon: 'M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z', color: '#3b82f6', desc: 'Короткий сигнал' },
      { key: 'timerStop', name: 'Стоп таймера', icon: 'M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z', color: '#ef4444', desc: 'Двойной сигнал' },
      { key: 'hourly', name: 'Каждый час', icon: 'M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9', color: '#10b981', desc: 'Напоминание' },
      { key: 'achievement', name: 'Достижение', icon: 'M9 12l2 2 4-4M7.835 4.697a3.42 3.42 0 001.946-.806 3.42 3.42 0 014.438 0 3.42 3.42 0 001.946.806 3.42 3.42 0 013.138 3.138 3.42 3.42 0 00.806 1.946 3.42 3.42 0 010 4.438 3.42 3.42 0 00-.806 1.946 3.42 3.42 0 01-3.138 3.138 3.42 3.42 0 00-1.946.806 3.42 3.42 0 01-4.438 0 3.42 3.42 0 00-1.946-.806 3.42 3.42 0 01-3.138-3.138 3.42 3.42 0 00-.806-1.946 3.42 3.42 0 010-4.438 3.42 3.42 0 00.806-1.946 3.42 3.42 0 013.138-3.138z', color: '#f59e0b', desc: 'Триумфальный' },
      { key: 'error', name: 'Ошибка', icon: 'M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z', color: '#ef4444', desc: 'Предупреждение' },
      { key: 'notification', name: 'Уведомление', icon: 'M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9', color: '#8b5cf6', desc: 'Мягкий сигнал' },
      { key: 'success', name: 'Успех', icon: 'M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z', color: '#10b981', desc: 'Позитивный' },
      { key: 'warning', name: 'Предупреждение', icon: 'M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z', color: '#f59e0b', desc: 'Средний тон' }
    ];

    let settings = {
      sounds: {},
      masterVolume: 80
    };

    function loadSettings() {
      const saved = localStorage.getItem('soundSettings');
      if (saved) {
        settings = JSON.parse(saved);
      } else {
        soundTypes.forEach(sound => {
          settings.sounds[sound.key] = {
            enabled: ['timerStart', 'timerStop', 'achievement', 'error', 'success', 'warning'].includes(sound.key),
            volume: 80
          };
        });
      }
      renderSounds();
      updateMasterVolume();
    }

    function renderSounds() {
      const container = document.getElementById('sound-grid');
      container.innerHTML = soundTypes.map(sound => {
        const soundSetting = settings.sounds[sound.key] || { enabled: false, volume: 80 };
        return `
          <div class="sound-card" style="border-left-color: ${sound.color}">
            <div class="card-bg" style="background: radial-gradient(circle at top right, ${sound.color}, transparent)"></div>
            <div class="card-content">
              <div class="card-header">
                <div id="icon-${sound.key}" class="sound-icon" style="background-color: ${sound.color}20; color: ${sound.color}">
                  <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="${sound.icon}"/>
                  </svg>
                  <div id="ring-${sound.key}" class="glow-ring" style="border-color: ${sound.color}"></div>
                </div>
                <div onclick="toggleSound('${sound.key}')" class="toggle-switch ${soundSetting.enabled ? 'active' : ''}"></div>
              </div>
              <h3 class="sound-title">${sound.name}</h3>
              <p class="sound-desc">${sound.desc}</p>
              <div id="wave-${sound.key}" class="wave-visual">
                ${[...Array(7)].map((_, i) => `
                  <div class="wave-line" style="background: ${sound.color}; animation-delay: ${i * 0.1}s"></div>
                `).join('')}
              </div>
              <div class="sound-controls">
                <input
                  type="range"
                  min="0"
                  max="100"
                  value="${soundSetting.volume}"
                  oninput="updateVolume('${sound.key}', this.value)"
                  class="volume-slider"
                  style="background: linear-gradient(to right, ${sound.color} 0%, ${sound.color} ${soundSetting.volume}%, #e5e7eb ${soundSetting.volume}%, #e5e7eb 100%)"
                />
                <span class="volume-value">${soundSetting.volume}%</span>
              </div>
              <button onclick="playVisual('${sound.key}')" class="play-btn">
                <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
                  <path d="M8 5v14l11-7z"/>
                </svg>
                Воспроизвести
              </button>
            </div>
          </div>
        `;
      }).join('');
    }

    function playVisual(key) {
      const icon = document.getElementById(`icon-${key}`);
      const ring = document.getElementById(`ring-${key}`);
      const wave = document.getElementById(`wave-${key}`);
      
      if (ring) {
        ring.classList.add('active');
        setTimeout(() => {
          ring.classList.remove('active');
        }, 800);
      }
      
      if (wave) {
        wave.classList.add('active');
        setTimeout(() => {
          wave.classList.remove('active');
        }, 1200);
      }
      
      if (icon) {
        icon.classList.add('playing');
        setTimeout(() => {
          icon.classList.remove('playing');
        }, 300);
      }
      
      const sound = soundEffects[key];
      if (!sound) return;
      
      const soundSetting = settings.sounds[key] || { volume: 80 };
      const volume = (soundSetting.volume / 100) * 0.3;
      
      if (typeof playSound === 'function') {
        playSound(key, volume);
      }
    }

    function updateVolume(key, value) {
      if (!settings.sounds[key]) {
        settings.sounds[key] = { enabled: false, volume: 80 };
      }
      settings.sounds[key].volume = parseInt(value);
      const slider = event.target;
      slider.style.background = `linear-gradient(to right, ${soundTypes.find(s => s.key === key).color} 0%, ${soundTypes.find(s => s.key === key).color} ${value}%, #e5e7eb ${value}%, #e5e7eb 100%)`;
      slider.nextElementSibling.textContent = value + '%';
    }

    function toggleSound(key) {
      if (!settings.sounds[key]) {
        settings.sounds[key] = { enabled: false, volume: 80 };
      }
      settings.sounds[key].enabled = !settings.sounds[key].enabled;
      const switchEl = event.target;
      switchEl.classList.toggle('active');
    }

    function updateMasterVolume() {
      const slider = document.getElementById('master-slider');
      const valueEl = document.getElementById('master-volume-value');
      
      slider.addEventListener('input', function(e) {
        const value = e.target.value;
        settings.masterVolume = parseInt(value);
        valueEl.textContent = value + '%';
        slider.style.background = `linear-gradient(to right, #3b82f6 0%, #3b82f6 ${value}%, #e5e7eb ${value}%, #e5e7eb 100%)`;
      });
    }

    function saveSettings() {
      localStorage.setItem('soundSettings', JSON.stringify(settings));
      if (typeof showNotification === 'function') {
        showNotification('Настройки сохранены', 'success');
      }
      closeModal();
    }

    function closeModal() {
      const modal = document.getElementById('modal');
      modal.style.animation = 'fadeIn 0.2s ease-out reverse';
      setTimeout(() => {
        modal.style.display = 'none';
      }, 200);
    }

    loadSettings();
  </script>
</body>
</html>

