<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–ö–æ–Ω—Ü–µ–ø—Ç 1: Sidebar Navigation - –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∑–≤—É–∫–æ–≤ –∏ –∞–Ω–∏–º–∞—Ü–∏–∏</title>
  <script src="shared-functionality.js"></script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
      color: #e2e8f0;
    }

    /* Glass Effect */
    .glass-effect {
      background: rgba(255, 255, 255, 0.08);
      backdrop-filter: blur(16px);
      -webkit-backdrop-filter: blur(16px);
      border: 1px solid rgba(255, 255, 255, 0.12);
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
    }

    .glass-card {
      background: rgba(255, 255, 255, 0.08);
      backdrop-filter: blur(16px);
      -webkit-backdrop-filter: blur(16px);
      border: 1px solid rgba(255, 255, 255, 0.12);
      border-radius: 12px;
      padding: 16px;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .glass-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 12px 40px rgba(0, 0, 0, 0.4);
      border-color: rgba(255, 255, 255, 0.2);
      background: rgba(255, 255, 255, 0.12);
    }

    /* Modal Container */
    .modal-container {
      width: 100%;
      max-width: 1200px;
      height: 90vh;
      max-height: 800px;
      display: flex;
      border-radius: 24px;
      overflow: hidden;
      animation: slideUp 0.3s ease-out;
    }

    @keyframes slideUp {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* Sidebar */
    .sidebar {
      width: 220px;
      background: rgba(15, 23, 42, 0.8);
      backdrop-filter: blur(20px);
      border-right: 1px solid rgba(255, 255, 255, 0.1);
      padding: 24px 0;
      display: flex;
      flex-direction: column;
    }

    .sidebar-header {
      padding: 0 20px 24px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      margin-bottom: 16px;
    }

    .sidebar-title {
      font-size: 18px;
      font-weight: 700;
      color: #fff;
      margin-bottom: 4px;
    }

    .sidebar-subtitle {
      font-size: 12px;
      color: #94a3b8;
    }

    .sidebar-tabs {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 4px;
      padding: 0 12px;
    }

    .sidebar-tab {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px 16px;
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.2s;
      color: #94a3b8;
      font-size: 14px;
      font-weight: 500;
      border: none;
      background: transparent;
      text-align: left;
      width: 100%;
    }

    .sidebar-tab:hover {
      background: rgba(255, 255, 255, 0.05);
      color: #e2e8f0;
    }

    .sidebar-tab.active {
      background: rgba(59, 130, 246, 0.2);
      color: #60a5fa;
      border-left: 3px solid #3b82f6;
    }

    .sidebar-tab-icon {
      width: 20px;
      height: 20px;
      flex-shrink: 0;
    }

    /* Main Content */
    .main-content {
      flex: 1;
      padding: 24px;
      overflow-y: auto;
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 20px;
      align-content: start;
    }

    .main-content::-webkit-scrollbar {
      width: 8px;
    }

    .main-content::-webkit-scrollbar-track {
      background: rgba(255, 255, 255, 0.05);
    }

    .main-content::-webkit-scrollbar-thumb {
      background: rgba(255, 255, 255, 0.2);
      border-radius: 4px;
    }

    /* Section Card */
    .section-card {
      grid-column: span 2;
    }

    .section-card.half {
      grid-column: span 1;
    }

    .section-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 16px;
    }

    .section-title {
      font-size: 14px;
      font-weight: 700;
      color: #fff;
    }

    /* Toggle Switch */
    .toggle-switch {
      position: relative;
      width: 44px;
      height: 24px;
      background: #475569;
      border-radius: 12px;
      cursor: pointer;
      transition: background 0.3s;
    }

    .toggle-switch.active {
      background: #3b82f6;
    }

    .toggle-switch::after {
      content: '';
      position: absolute;
      top: 2px;
      left: 2px;
      width: 20px;
      height: 20px;
      background: #fff;
      border-radius: 50%;
      transition: transform 0.3s;
    }

    .toggle-switch.active::after {
      transform: translateX(20px);
    }

    /* Form Controls */
    .form-group {
      margin-bottom: 16px;
    }

    .form-label {
      display: block;
      font-size: 12px;
      font-weight: 600;
      color: #cbd5e1;
      margin-bottom: 8px;
    }

    .form-select, .form-input {
      width: 100%;
      padding: 10px 12px;
      background: rgba(30, 41, 59, 0.6);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 8px;
      color: #e2e8f0;
      font-size: 14px;
      cursor: pointer;
    }

    .form-select:focus, .form-input:focus {
      outline: none;
      border-color: #3b82f6;
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    }

    /* Sound Grid */
    .sound-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 8px;
    }

    .sound-btn {
      padding: 10px;
      background: rgba(30, 41, 59, 0.6);
      border: 2px solid rgba(255, 255, 255, 0.1);
      border-radius: 8px;
      color: #cbd5e1;
      font-size: 12px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .sound-btn:hover {
      border-color: #3b82f6;
      transform: scale(1.02);
    }

    .sound-btn.active {
      border-color: #3b82f6;
      background: rgba(59, 130, 246, 0.1);
      color: #fff;
    }

    .play-icon {
      width: 16px;
      height: 16px;
      opacity: 0.6;
      transition: opacity 0.2s;
    }

    .sound-btn:hover .play-icon {
      opacity: 1;
    }

    /* Slider */
    .slider-container {
      position: relative;
    }

    .slider {
      width: 100%;
      height: 6px;
      background: rgba(30, 41, 59, 0.6);
      border-radius: 3px;
      outline: none;
      -webkit-appearance: none;
    }

    .slider::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 18px;
      height: 18px;
      background: #3b82f6;
      border-radius: 50%;
      cursor: pointer;
    }

    .slider::-moz-range-thumb {
      width: 18px;
      height: 18px;
      background: #3b82f6;
      border-radius: 50%;
      cursor: pointer;
      border: none;
    }

    .slider-labels {
      display: flex;
      justify-content: space-between;
      font-size: 11px;
      color: #94a3b8;
      margin-top: 4px;
    }

    /* Buttons */
    .btn {
      padding: 10px 20px;
      border-radius: 8px;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      border: none;
    }

    .btn-primary {
      background: #3b82f6;
      color: #fff;
    }

    .btn-primary:hover {
      background: #2563eb;
      transform: translateY(-1px);
    }

    .btn-secondary {
      background: rgba(30, 41, 59, 0.6);
      color: #e2e8f0;
    }

    .btn-secondary:hover {
      background: rgba(30, 41, 59, 0.8);
    }

    .btn-warning {
      background: #f59e0b;
      color: #fff;
    }

    .btn-danger {
      background: #ef4444;
      color: #fff;
    }

    /* Favicon Preview */
    .favicon-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 8px;
    }

    .favicon-preview {
      padding: 12px;
      border: 2px solid rgba(255, 255, 255, 0.1);
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s;
      text-align: center;
    }

    .favicon-preview:hover {
      border-color: #3b82f6;
      transform: scale(1.05);
    }

    .favicon-preview.active {
      border-color: #3b82f6;
      background: rgba(59, 130, 246, 0.1);
    }

    .favicon-canvas {
      width: 32px;
      height: 32px;
      margin: 0 auto 8px;
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 4px;
      image-rendering: pixelated;
    }

    .favicon-label {
      font-size: 10px;
      color: #94a3b8;
    }

    /* Color Picker */
    .color-grid {
      display: grid;
      grid-template-columns: repeat(8, 1fr);
      gap: 8px;
    }

    .color-btn {
      width: 36px;
      height: 36px;
      border-radius: 8px;
      border: 2px solid rgba(255, 255, 255, 0.2);
      cursor: pointer;
      transition: all 0.2s;
    }

    .color-btn:hover {
      transform: scale(1.1);
      border-color: #3b82f6;
    }

    .color-btn.active {
      border-color: #3b82f6;
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.3);
    }

    /* Footer */
    .modal-footer {
      padding: 20px 24px;
      border-top: 1px solid rgba(255, 255, 255, 0.1);
      display: flex;
      gap: 12px;
      justify-content: flex-end;
      background: rgba(15, 23, 42, 0.8);
    }

    /* Responsive */
    @media (max-width: 768px) {
      .modal-container {
        flex-direction: column;
        height: auto;
        max-height: 90vh;
      }

      .sidebar {
        width: 100%;
        flex-direction: row;
        padding: 12px;
        overflow-x: auto;
      }

      .sidebar-tabs {
        flex-direction: row;
        gap: 8px;
      }

      .sidebar-tab {
        white-space: nowrap;
      }

      .main-content {
        grid-template-columns: 1fr;
      }

      .section-card.half {
        grid-column: span 1;
      }
    }

    /* Hidden */
    .hidden {
      display: none !important;
    }
  </style>
</head>
<body>
  <div class="modal-container glass-effect">
    <!-- Sidebar -->
    <div class="sidebar">
      <div class="sidebar-header">
        <div class="sidebar-title">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</div>
        <div class="sidebar-subtitle">–ó–≤—É–∫–∏ –∏ –∞–Ω–∏–º–∞—Ü–∏—è</div>
      </div>
      <div class="sidebar-tabs">
        <button class="sidebar-tab active" data-tab="notifications">
          <svg class="sidebar-tab-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"/>
          </svg>
          <span>–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</span>
        </button>
        <button class="sidebar-tab" data-tab="pomodoro">
          <svg class="sidebar-tab-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
          </svg>
          <span>Pomodoro</span>
        </button>
        <button class="sidebar-tab" data-tab="favicon">
          <svg class="sidebar-tab-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zm0 0h12a2 2 0 002-2v-4a2 2 0 00-2-2h-2.343M11 7.343l1.657-1.657a2 2 0 012.828 0l2.829 2.829a2 2 0 010 2.828l-8.486 8.485M7 17h.01"/>
          </svg>
          <span>–§–∞–≤–∏–∫–æ–Ω</span>
        </button>
      </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
      <!-- Tab: Notifications -->
      <div id="tab-notifications" class="tab-content">
        <!-- Sound Notifications -->
        <div class="glass-card section-card">
          <div class="section-header">
            <h3 class="section-title">–ó–≤—É–∫–æ–≤—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</h3>
            <div class="toggle-switch active" id="toggle-sound-notifications"></div>
          </div>
          <div id="sound-notifications-content">
            <div class="form-group">
              <label class="form-label">–ò–Ω—Ç–µ—Ä–≤–∞–ª</label>
              <div style="display: flex; gap: 8px;">
                <select class="form-select" id="notification-interval" style="flex: 1;">
                  <option value="15">15 –º–∏–Ω—É—Ç</option>
                  <option value="30" selected>30 –º–∏–Ω—É—Ç</option>
                  <option value="45">45 –º–∏–Ω—É—Ç</option>
                  <option value="60">1 —á–∞—Å</option>
                  <option value="120">2 —á–∞—Å–∞</option>
                  <option value="custom">–ö–∞—Å—Ç–æ–º–Ω–æ–µ</option>
                </select>
                <input type="number" class="form-input hidden" id="custom-interval" placeholder="–ú–∏–Ω" style="width: 80px;" min="1" max="1440">
              </div>
            </div>
            <div class="form-group">
              <label class="form-label">–¢–∏–ø –∑–≤—É–∫–∞</label>
              <div class="sound-grid" id="sound-types-grid"></div>
            </div>
          </div>
        </div>

        <!-- Break Reminders -->
        <div class="glass-card section-card half">
          <div class="section-header">
            <h3 class="section-title">–ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –æ –ø–µ—Ä–µ—Ä—ã–≤–∞—Ö</h3>
            <div class="toggle-switch active" id="toggle-break-reminders"></div>
          </div>
          <div id="break-reminders-content">
            <div class="form-group">
              <label class="form-label">–ò–Ω—Ç–µ—Ä–≤–∞–ª</label>
              <div style="display: flex; gap: 8px;">
                <select class="form-select" id="break-interval" style="flex: 1;">
                  <option value="1">–ö–∞–∂–¥—ã–π —á–∞—Å</option>
                  <option value="2" selected>–ö–∞–∂–¥—ã–µ 2 —á–∞—Å–∞</option>
                  <option value="3">–ö–∞–∂–¥—ã–µ 3 —á–∞—Å–∞</option>
                  <option value="4">–ö–∞–∂–¥—ã–µ 4 —á–∞—Å–∞</option>
                  <option value="6">–ö–∞–∂–¥—ã–µ 6 —á–∞—Å–æ–≤</option>
                </select>
                <button class="btn btn-primary" onclick="testBreakReminder()">–ü—Ä–∏–º–µ—Ä</button>
              </div>
            </div>
          </div>
        </div>

        <!-- Overtime Alerts -->
        <div class="glass-card section-card half">
          <div class="section-header">
            <h3 class="section-title">–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –æ –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∫–µ</h3>
            <div class="toggle-switch active" id="toggle-overtime-alerts"></div>
          </div>
          <div id="overtime-alerts-content">
            <div class="form-group">
              <label class="form-label">–ü–æ—Ä–æ–≥ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è: <span id="warning-threshold-value">8.0</span> —á</label>
              <input type="range" class="slider" id="warning-threshold" min="0.5" max="2.0" step="0.1" value="1.0">
              <div class="slider-labels">
                <span>50%</span>
                <span>100%</span>
                <span>200%</span>
              </div>
            </div>
            <div class="form-group">
              <label class="form-label">–ü–æ—Ä–æ–≥ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–≥–æ: <span id="critical-threshold-value">12.0</span> —á</label>
              <input type="range" class="slider" id="critical-threshold" min="1.0" max="3.0" step="0.1" value="1.5">
              <div class="slider-labels">
                <span>100%</span>
                <span>200%</span>
                <span>300%</span>
              </div>
            </div>
            <div class="form-group" style="display: flex; align-items: center; justify-content: space-between;">
              <label class="form-label" style="margin: 0;">–ó–≤—É–∫–æ–≤–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ</label>
              <div class="toggle-switch active" id="toggle-overtime-sound"></div>
            </div>
            <div style="display: flex; gap: 8px; margin-top: 12px;">
              <button class="btn btn-warning" style="flex: 1;" onclick="testOvertimeAlert(false)">–ü—Ä–∏–º–µ—Ä –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è</button>
              <button class="btn btn-danger" style="flex: 1;" onclick="testOvertimeAlert(true)">–ü—Ä–∏–º–µ—Ä –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–≥–æ</button>
            </div>
          </div>
        </div>
      </div>

      <!-- Tab: Pomodoro -->
      <div id="tab-pomodoro" class="tab-content hidden">
        <div class="glass-card section-card">
          <div class="section-header">
            <h3 class="section-title">Pomodoro —Ç–∞–π–º–µ—Ä</h3>
            <div class="toggle-switch" id="toggle-pomodoro"></div>
          </div>
          <div id="pomodoro-content">
            <p style="font-size: 12px; color: #94a3b8; margin-bottom: 16px;">
              –¢–µ—Ö–Ω–∏–∫–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤—Ä–µ–º–µ–Ω–µ–º: —Ä–∞–±–æ—Ç–∞ —Ä–∞–∑–±–∏–≤–∞–µ—Ç—Å—è –Ω–∞ –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã –ø–æ 25 –º–∏–Ω—É—Ç (–ø–æ–º–æ–¥–æ—Ä–æ), —Ä–∞–∑–¥–µ–ª–µ–Ω–Ω—ã–µ –ø–µ—Ä–µ—Ä—ã–≤–∞–º–∏.
            </p>
            <div class="form-group" style="display: flex; align-items: center; justify-content: space-between;">
              <div>
                <label class="form-label" style="margin: 0;">–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å–∫–∞—Ç—å –ø–µ—Ä–µ—Ä—ã–≤—ã</label>
                <p style="font-size: 11px; color: #64748b; margin-top: 4px;">–ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ä–∞–±–æ—Ç—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ø–µ—Ä–µ—Ä—ã–≤</p>
              </div>
              <div class="toggle-switch active" id="toggle-pomodoro-breaks"></div>
            </div>
            <div class="form-group" style="display: flex; align-items: center; justify-content: space-between;">
              <div>
                <label class="form-label" style="margin: 0;">–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å–∫–∞—Ç—å —Ä–∞–±–æ—Ç—É</label>
                <p style="font-size: 11px; color: #64748b; margin-top: 4px;">–ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –ø–µ—Ä–µ—Ä—ã–≤–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —Ä–∞–±–æ—Ç–∞</p>
              </div>
              <div class="toggle-switch" id="toggle-pomodoro-work"></div>
            </div>
            <div class="form-group" style="display: flex; align-items: center; justify-content: space-between;">
              <div>
                <label class="form-label" style="margin: 0;">–ó–≤—É–∫ –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞</label>
                <p style="font-size: 11px; color: #64748b; margin-top: 4px;">–í–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—å –∑–≤—É–∫ –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ —Ä–∞–±–æ—Ç—ã –∏–ª–∏ –ø–µ—Ä–µ—Ä—ã–≤–∞</p>
              </div>
              <div class="toggle-switch active" id="toggle-pomodoro-sound"></div>
            </div>
            <div class="form-group" style="display: flex; align-items: center; justify-content: space-between;">
              <div>
                <label class="form-label" style="margin: 0;">–ü–æ–∫–∞–∑—ã–≤–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</label>
                <p style="font-size: 11px; color: #64748b; margin-top: 4px;">–ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –≤–∏–∑—É–∞–ª—å–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–≤</p>
              </div>
              <div class="toggle-switch active" id="toggle-pomodoro-notifications"></div>
            </div>
            <button class="btn btn-primary" onclick="testPomodoroNotification()" style="margin-top: 8px;">–ü—Ä–∏–º–µ—Ä</button>
          </div>
        </div>
      </div>

      <!-- Tab: Favicon -->
      <div id="tab-favicon" class="tab-content hidden">
        <div class="glass-card section-card">
          <div class="section-header">
            <h3 class="section-title">–ê–Ω–∏–º–∞—Ü–∏—è —Ñ–∞–≤–∏–∫–æ–Ω–∞</h3>
            <div class="toggle-switch active" id="toggle-favicon"></div>
          </div>
          <div id="favicon-content">
            <div class="form-group">
              <label class="form-label">–°—Ç–∏–ª—å –∞–Ω–∏–º–∞—Ü–∏–∏</label>
              <div class="favicon-grid" id="favicon-styles-grid"></div>
            </div>
            <div class="form-group">
              <label class="form-label">–¶–≤–µ—Ç</label>
              <div class="color-grid" id="color-picker-grid"></div>
            </div>
            <div class="form-group">
              <label class="form-label">–°–∫–æ—Ä–æ—Å—Ç—å</label>
              <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px;">
                <button class="btn btn-secondary" data-speed="slow" onclick="setFaviconSpeed('slow')">–ú–µ–¥–ª–µ–Ω–Ω–æ</button>
                <button class="btn btn-primary" data-speed="normal" onclick="setFaviconSpeed('normal')">–û–±—ã—á–Ω–æ</button>
                <button class="btn btn-secondary" data-speed="fast" onclick="setFaviconSpeed('fast')">–ë—ã—Å—Ç—Ä–æ</button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Footer -->
    <div class="modal-footer">
      <button class="btn btn-secondary" onclick="closeModal()">–û—Ç–º–µ–Ω–∞</button>
      <button class="btn btn-primary" onclick="saveSettings()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
    </div>
  </div>

  <script>
    // State
    let state = {
      soundNotificationsEnabled: true,
      notificationInterval: 30,
      customIntervalMinutes: null,
      notificationSound: 'chime',
      breakRemindersEnabled: true,
      breakReminderInterval: 2,
      overtimeAlertsEnabled: true,
      overtimeWarningThreshold: 1.0,
      overtimeCriticalThreshold: 1.5,
      overtimeSoundAlert: true,
      pomodoroEnabled: false,
      pomodoroAutoStartBreaks: true,
      pomodoroAutoStartWork: false,
      pomodoroSoundOnComplete: true,
      pomodoroShowNotifications: true,
      faviconAnimationEnabled: true,
      faviconAnimationStyle: 'pulse',
      faviconAnimationColor: '#3b82f6',
      faviconAnimationSpeed: 'normal',
      activeTab: 'notifications'
    };

    // Sound types
    const soundTypes = [
      { value: 'chime', label: '–ú–µ–ª–æ–¥–∏—è' },
      { value: 'alert', label: '–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ' },
      { value: 'phone', label: '–ó–≤–æ–Ω–æ–∫' },
      { value: 'doorbell', label: '–î–≤–µ—Ä–Ω–æ–π –∑–≤–æ–Ω–æ–∫' },
      { value: 'alarm', label: '–¢—Ä–µ–≤–æ–≥–∞' },
      { value: 'notification', label: '–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ' },
      { value: 'bell', label: '–ö–æ–ª–æ–∫–æ–ª' },
      { value: 'beep', label: '–°–∏–≥–Ω–∞–ª' },
      { value: 'ping', label: '–ü–∏–Ω–≥' }
    ];

    // Animation styles
    const animationStyles = [
      { value: 'pulse', label: '–ü—É–ª—å—Å–∞—Ü–∏—è' },
      { value: 'blink', label: '–ú–∏–≥–∞–Ω–∏–µ' },
      { value: 'rotate', label: '–í—Ä–∞—â–µ–Ω–∏–µ' },
      { value: 'breathe', label: '–î—ã—Ö–∞–Ω–∏–µ' },
      { value: 'wave', label: '–í–æ–ª–Ω–∞' },
      { value: 'gradient', label: '–ì—Ä–∞–¥–∏–µ–Ω—Ç' },
      { value: 'data-pulse', label: 'Data Pulse' },
      { value: 'particles', label: '–ß–∞—Å—Ç–∏—Ü—ã' }
    ];

    // Preset colors
    const presetColors = [
      { value: '#3b82f6', label: '–°–∏–Ω–∏–π' },
      { value: '#22c55e', label: '–ó–µ–ª–µ–Ω—ã–π' },
      { value: '#f97316', label: '–û—Ä–∞–Ω–∂–µ–≤—ã–π' },
      { value: '#ef4444', label: '–ö—Ä–∞—Å–Ω—ã–π' },
      { value: '#8b5cf6', label: '–§–∏–æ–ª–µ—Ç–æ–≤—ã–π' },
      { value: '#06b6d4', label: '–ì–æ–ª—É–±–æ–π' },
      { value: '#fbbf24', label: '–ñ–µ–ª—Ç—ã–π' }
    ];

    // Initialize
    function init() {
      loadSettings();
      renderSoundTypes();
      renderFaviconStyles();
      renderColorPicker();
      setupEventListeners();
      updateUI();
    }

    // Load settings from localStorage
    function loadSettings() {
      const saved = localStorage.getItem('soundAnimationSettings');
      if (saved) {
        Object.assign(state, JSON.parse(saved));
      }
    }

    // Save settings
    function saveSettings() {
      localStorage.setItem('soundAnimationSettings', JSON.stringify(state));
      if (typeof showNotification === 'function') {
        showNotification('–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã', 'success');
      }
    }

    // Render sound types
    function renderSoundTypes() {
      const grid = document.getElementById('sound-types-grid');
      grid.innerHTML = soundTypes.map(sound => `
        <button class="sound-btn ${state.notificationSound === sound.value ? 'active' : ''}" 
                onclick="selectSound('${sound.value}')">
          <span>${sound.label}</span>
          <svg class="play-icon" fill="currentColor" viewBox="0 0 24 24" onclick="event.stopPropagation(); playSoundLocal('${sound.value}')">
            <path d="M8 5v14l11-7z"/>
          </svg>
        </button>
      `).join('');
    }

    // Render favicon styles
    function renderFaviconStyles() {
      const grid = document.getElementById('favicon-styles-grid');
      grid.innerHTML = animationStyles.map(style => `
        <div class="favicon-preview ${state.faviconAnimationStyle === style.value ? 'active' : ''}" 
             onclick="selectFaviconStyle('${style.value}')"
             onmouseenter="startFaviconPreview('${style.value}')"
             onmouseleave="stopFaviconPreview()">
          <canvas class="favicon-canvas" width="32" height="32" data-style="${style.value}"></canvas>
          <div class="favicon-label">${style.label}</div>
        </div>
      `).join('');
    }

    // Render color picker
    function renderColorPicker() {
      const grid = document.getElementById('color-picker-grid');
      grid.innerHTML = presetColors.map(color => `
        <button class="color-btn ${state.faviconAnimationColor === color.value ? 'active' : ''}" 
                style="background: ${color.value}"
                onclick="selectColor('${color.value}')"
                title="${color.label}"></button>
      `).join('') + `
        <div class="color-btn ${!presetColors.some(c => c.value === state.faviconAnimationColor) ? 'active' : ''}" 
             style="background: linear-gradient(135deg, #3b82f6, #8b5cf6, #ec4899); position: relative;">
          <input type="color" value="${state.faviconAnimationColor}" 
                 onchange="selectColor(this.value)" 
                 style="position: absolute; inset: 0; opacity: 0; cursor: pointer; width: 100%; height: 100%;">
        </div>
      `;
    }

    // Setup event listeners
    function setupEventListeners() {
      // Tabs
      document.querySelectorAll('.sidebar-tab').forEach(tab => {
        tab.addEventListener('click', () => switchTab(tab.dataset.tab));
      });

      // Toggles
      document.getElementById('toggle-sound-notifications').addEventListener('click', () => toggle('soundNotificationsEnabled'));
      document.getElementById('toggle-break-reminders').addEventListener('click', () => toggle('breakRemindersEnabled'));
      document.getElementById('toggle-overtime-alerts').addEventListener('click', () => toggle('overtimeAlertsEnabled'));
      document.getElementById('toggle-overtime-sound').addEventListener('click', () => toggle('overtimeSoundAlert'));
      document.getElementById('toggle-pomodoro').addEventListener('click', () => toggle('pomodoroEnabled'));
      document.getElementById('toggle-pomodoro-breaks').addEventListener('click', () => toggle('pomodoroAutoStartBreaks'));
      document.getElementById('toggle-pomodoro-work').addEventListener('click', () => toggle('pomodoroAutoStartWork'));
      document.getElementById('toggle-pomodoro-sound').addEventListener('click', () => toggle('pomodoroSoundOnComplete'));
      document.getElementById('toggle-pomodoro-notifications').addEventListener('click', () => toggle('pomodoroShowNotifications'));
      document.getElementById('toggle-favicon').addEventListener('click', () => toggle('faviconAnimationEnabled'));

      // Interval select
      document.getElementById('notification-interval').addEventListener('change', (e) => {
        if (e.target.value === 'custom') {
          state.notificationInterval = -1;
          document.getElementById('custom-interval').classList.remove('hidden');
          if (!state.customIntervalMinutes) state.customIntervalMinutes = 30;
          document.getElementById('custom-interval').value = state.customIntervalMinutes;
        } else {
          state.notificationInterval = parseInt(e.target.value);
          document.getElementById('custom-interval').classList.add('hidden');
        }
      });

      document.getElementById('custom-interval').addEventListener('input', (e) => {
        const value = parseInt(e.target.value);
        if (value >= 1 && value <= 1440) {
          state.customIntervalMinutes = value;
        }
      });

      // Break interval
      document.getElementById('break-interval').addEventListener('change', (e) => {
        state.breakReminderInterval = parseInt(e.target.value);
      });

      // Sliders
      document.getElementById('warning-threshold').addEventListener('input', (e) => {
        state.overtimeWarningThreshold = parseFloat(e.target.value);
        document.getElementById('warning-threshold-value').textContent = (8 * state.overtimeWarningThreshold).toFixed(1);
      });

      document.getElementById('critical-threshold').addEventListener('input', (e) => {
        state.overtimeCriticalThreshold = parseFloat(e.target.value);
        document.getElementById('critical-threshold-value').textContent = (8 * state.overtimeCriticalThreshold).toFixed(1);
      });
    }

    // Toggle function
    function toggle(key) {
      state[key] = !state[key];
      updateUI();
    }

    // Update UI
    function updateUI() {
      // Update toggles
      document.getElementById('toggle-sound-notifications').classList.toggle('active', state.soundNotificationsEnabled);
      document.getElementById('sound-notifications-content').style.display = state.soundNotificationsEnabled ? 'block' : 'none';
      
      document.getElementById('toggle-break-reminders').classList.toggle('active', state.breakRemindersEnabled);
      document.getElementById('break-reminders-content').style.display = state.breakRemindersEnabled ? 'block' : 'none';
      
      document.getElementById('toggle-overtime-alerts').classList.toggle('active', state.overtimeAlertsEnabled);
      document.getElementById('overtime-alerts-content').style.display = state.overtimeAlertsEnabled ? 'block' : 'none';
      
      document.getElementById('toggle-overtime-sound').classList.toggle('active', state.overtimeSoundAlert);
      
      document.getElementById('toggle-pomodoro').classList.toggle('active', state.pomodoroEnabled);
      document.getElementById('pomodoro-content').style.display = state.pomodoroEnabled ? 'block' : 'none';
      
      document.getElementById('toggle-pomodoro-breaks').classList.toggle('active', state.pomodoroAutoStartBreaks);
      document.getElementById('toggle-pomodoro-work').classList.toggle('active', state.pomodoroAutoStartWork);
      document.getElementById('toggle-pomodoro-sound').classList.toggle('active', state.pomodoroSoundOnComplete);
      document.getElementById('toggle-pomodoro-notifications').classList.toggle('active', state.pomodoroShowNotifications);
      
      document.getElementById('toggle-favicon').classList.toggle('active', state.faviconAnimationEnabled);
      document.getElementById('favicon-content').style.display = state.faviconAnimationEnabled ? 'block' : 'none';
    }

    // Switch tab
    function switchTab(tab) {
      state.activeTab = tab;
      document.querySelectorAll('.sidebar-tab').forEach(t => t.classList.remove('active'));
      document.querySelector(`[data-tab="${tab}"]`).classList.add('active');
      document.querySelectorAll('.tab-content').forEach(t => t.classList.add('hidden'));
      document.getElementById(`tab-${tab}`).classList.remove('hidden');
    }

    // Select sound
    function selectSound(value) {
      state.notificationSound = value;
      renderSoundTypes();
    }

    // Play sound locally
    function playSoundLocal(type) {
      if (typeof playSound === 'function') {
        playSound(type, 0.3);
      }
    }

    // Select favicon style
    function selectFaviconStyle(value) {
      state.faviconAnimationStyle = value;
      renderFaviconStyles();
    }

    // Select color
    function selectColor(value) {
      state.faviconAnimationColor = value;
      renderColorPicker();
      renderFaviconStyles();
    }

    // Set favicon speed
    function setFaviconSpeed(value) {
      state.faviconAnimationSpeed = value;
      document.querySelectorAll('[data-speed]').forEach(btn => {
        btn.classList.remove('btn-primary');
        btn.classList.add('btn-secondary');
      });
      document.querySelector(`[data-speed="${value}"]`).classList.remove('btn-secondary');
      document.querySelector(`[data-speed="${value}"]`).classList.add('btn-primary');
    }

    // Favicon preview animation
    let faviconAnimationFrame = null;
    function startFaviconPreview(style) {
      const canvas = document.querySelector(`[data-style="${style}"]`);
      if (!canvas) return;
      const ctx = canvas.getContext('2d');
      const color = state.faviconAnimationColor;
      const speedMap = { slow: 4000, normal: 2000, fast: 1000 };
      const speed = speedMap[state.faviconAnimationSpeed] || 2000;

      function animate() {
        ctx.clearRect(0, 0, 32, 32);
        const time = Date.now() / speed;

        switch(style) {
          case 'pulse':
            const pulseValue = 0.5 + Math.sin(time * Math.PI * 4) * 0.5;
            ctx.fillStyle = color;
            ctx.beginPath();
            ctx.arc(16, 16, 8 + pulseValue * 8, 0, Math.PI * 2);
            ctx.fill();
            break;
          case 'blink':
            const blinkValue = Math.floor(time) % 2 === 0 ? 1 : 0.2;
            ctx.globalAlpha = blinkValue;
            ctx.fillStyle = color;
            ctx.beginPath();
            ctx.arc(16, 16, 14, 0, Math.PI * 2);
            ctx.fill();
            ctx.globalAlpha = 1;
            break;
          case 'rotate':
            ctx.save();
            ctx.translate(16, 16);
            ctx.rotate(((time * 0.5) % 1) * Math.PI * 2);
            ctx.translate(-16, -16);
            ctx.fillStyle = color;
            ctx.beginPath();
            ctx.arc(16, 16, 14, 0, Math.PI * 2);
            ctx.fill();
            ctx.fillStyle = '#ffffff';
            ctx.beginPath();
            ctx.moveTo(16, 4);
            ctx.lineTo(12, 12);
            ctx.lineTo(20, 12);
            ctx.closePath();
            ctx.fill();
            ctx.restore();
            break;
          default:
            ctx.fillStyle = color;
            ctx.beginPath();
            ctx.arc(16, 16, 14, 0, Math.PI * 2);
            ctx.fill();
        }

        faviconAnimationFrame = requestAnimationFrame(animate);
      }
      animate();
    }

    function stopFaviconPreview() {
      if (faviconAnimationFrame) {
        cancelAnimationFrame(faviconAnimationFrame);
        faviconAnimationFrame = null;
      }
      document.querySelectorAll('.favicon-canvas').forEach(canvas => {
        const ctx = canvas.getContext('2d');
        ctx.clearRect(0, 0, 32, 32);
        ctx.fillStyle = state.faviconAnimationColor;
        ctx.beginPath();
        ctx.arc(16, 16, 14, 0, Math.PI * 2);
        ctx.fill();
      });
    }

    // Test functions
    function testBreakReminder() {
      const hours = state.breakReminderInterval;
      const message = `‚è∏Ô∏è –ü–æ—Ä–∞ —Å–¥–µ–ª–∞—Ç—å –ø–µ—Ä–µ—Ä—ã–≤! –í—ã —Ä–∞–±–æ—Ç–∞–µ—Ç–µ —É–∂–µ ${hours} ${hours === 1 ? '—á–∞—Å' : hours < 5 ? '—á–∞—Å–∞' : '—á–∞—Å–æ–≤'}.`;
      if (typeof showNotification === 'function') {
        showNotification(message, 'warning');
      }
    }

    function testOvertimeAlert(isCritical) {
      const threshold = isCritical ? state.overtimeCriticalThreshold : state.overtimeWarningThreshold;
      const totalHours = 8 * threshold;
      const message = isCritical 
        ? `üö® –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∫–∞! –í—ã —Ä–∞–±–æ—Ç–∞–µ—Ç–µ —É–∂–µ ${totalHours.toFixed(1)} —á–∞—Å–æ–≤.`
        : `‚ö†Ô∏è –ü–µ—Ä–µ—Ä–∞–±–æ—Ç–∫–∞! –í—ã —Ä–∞–±–æ—Ç–∞–µ—Ç–µ —É–∂–µ ${totalHours.toFixed(1)} —á–∞—Å–æ–≤.`;
      if (typeof showNotification === 'function') {
        showNotification(message, isCritical ? 'error' : 'warning');
      }
    }

    function testPomodoroNotification() {
      const message = 'üçÖ Pomodoro –∑–∞–≤–µ—Ä—à–µ–Ω! –ü–æ—Ä–∞ —Å–¥–µ–ª–∞—Ç—å –ø–µ—Ä–µ—Ä—ã–≤.';
      if (typeof showNotification === 'function') {
        showNotification(message, 'success');
      }
    }

    function closeModal() {
      if (confirm('–ó–∞–∫—Ä—ã—Ç—å –±–µ–∑ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è?')) {
        window.close();
      }
    }

    // Initialize on load
    init();
  </script>
</body>
</html>

